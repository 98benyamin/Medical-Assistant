import asyncio
import logging
import requests
import re
import time
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, ReplyKeyboardMarkup, ReplyKeyboardRemove
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, MessageHandler, ContextTypes, filters
from telegram.error import TelegramError, NetworkError, TimedOut
from fastapi import FastAPI, Request
from fastapi.responses import Response
import uvicorn
from threading import Lock

# ØªÙ†Ø¸ÛŒÙ… Ù„Ø§Ú¯
logging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level=logging.INFO)
logger = logging.getLogger(__name__)

# ØªÙˆÚ©Ù† Ùˆ ÙˆØ¨â€ŒÙ‡ÙˆÚ©
TOKEN = '8123059269:AAHlvWT2ZZ3iC1ICRkmiuwTjBHvdM-NLy18'
WEBHOOK_URL = 'https://medical-assistant-rum5.onrender.com/webhook'

# Ø¢Ø¯Ø±Ø³ API Ù…ØªÙ†ÛŒ Ùˆ ØªØ­Ù„ÛŒÙ„ ØªØµÙˆÛŒØ±
TEXT_API_URL = 'https://text.pollinations.ai/openai'

# Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ù†Ø§Ù„
CHANNEL_ID = '@bbbyyyrt'
CHANNEL_LINK = 'https://t.me/bbbyyyrt'

# Ù¾Ø±Ø§Ù…Ù¾â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¨Ø®Ø´
SYSTEM_MESSAGES = {
    "ai_chat": """
Ø´Ù…Ø§ ÛŒÚ© Ø¯Ø³ØªÛŒØ§Ø± Ù¾Ø²Ø´Ú©ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ùˆ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¯Ø± Ø­ÙˆØ²Ù‡ Ø³Ù„Ø§Ù…Øª Ùˆ Ù¾Ø²Ø´Ú©ÛŒ Ú©Ù…Ú© Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯. ğŸ˜Š Ø¨Ø§ Ù„Ø­Ù† Ø®ÙˆØ¯Ù…ÙˆÙ†ÛŒØŒ Ù…Ù‡Ø±Ø¨ÙˆÙ† Ùˆ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†â€ŒØ¨Ø®Ø´ Ù¾Ø§Ø³Ø® Ø¨Ø¯Ù‡ØŒ Ø§Ù…Ø§ Ù‡Ù…ÛŒØ´Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ù‚ÛŒÙ‚ Ùˆ Ø¹Ù„Ù…ÛŒ Ø§Ø±Ø§Ø¦Ù‡ Ú©Ù†. Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ø±Ùˆ Ø¨Ø§ Ù‚Ø§Ù„Ø¨â€ŒØ¨Ù†Ø¯ÛŒ Markdown (Ù…Ø«Ù„ **Ø¨ÙˆÙ„Ø¯**ØŒ *Ø§ÛŒØªØ§Ù„ÛŒÚ©*ØŒ ÛŒØ§ - Ù„ÛŒØ³Øª) Ø§Ø±Ø§Ø¦Ù‡ Ø¨Ø¯Ù‡. ÙˆØ¸Ø§ÛŒÙ Ø´Ù…Ø§:

1. **Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø³Ø¤Ø§Ù„Ø§Øª Ù¾Ø²Ø´Ú©ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ**:
   - Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§ Ùˆ Ø¯Ø§Ø±ÙˆÙ‡Ø§ÛŒ Ù…Ù†Ø§Ø³Ø¨ Ù¾Ø±Ø³ÛŒØ¯ØŒ Ø¯Ø§Ø±ÙˆÙ‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ (Ù…Ø«Ù„ *Ø§Ø³ØªØ§Ù…ÛŒÙ†ÙˆÙÙ†*ØŒ *Ø§ÛŒØ¨ÙˆÙ¾Ø±ÙˆÙÙ†*ØŒ *Ø¢Ù…ÙˆÚ©Ø³ÛŒâ€ŒØ³ÛŒÙ„ÛŒÙ†*) Ùˆ Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§Ø´ÙˆÙ† Ø±Ùˆ ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù‡.
   - Ø¨Ø±Ø§ÛŒ Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø¯Ù‡ (Ù…Ø«Ù„ Ø³Ø±Ù…Ø§Ø®ÙˆØ±Ø¯Ú¯ÛŒØŒ Ø³Ø±Ø¯Ø±Ø¯)ØŒ Ø±Ø§Ù‡Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ Ùˆ Ø¯Ø§Ø±ÙˆÙ‡Ø§ÛŒ Ø¨Ø¯ÙˆÙ† Ù†Ø³Ø®Ù‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø¯Ù‡.
   - Ø§Ú¯Ø± Ù…ÙˆØ¶ÙˆØ¹ ØªØ®ØµØµÛŒ ÛŒØ§ Ù¾ÛŒÚ†ÛŒØ¯Ù‡ Ø¨ÙˆØ¯ØŒ Ø¨Ù†ÙˆÛŒØ³: **Ø§ÛŒÙ† Ù…ÙˆØ±Ø¯ ØªØ®ØµØµÛŒÙ‡! ğŸš¨ Ø¨Ù‡ØªØ±Ù‡ Ø¨Ø§ ÛŒÙ‡ Ù¾Ø²Ø´Ú© Ù…ØªØ®ØµØµ Ù…Ø´ÙˆØ±Øª Ú©Ù†ÛŒ.**

2. **Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù¾Ø²Ø´Ú©ÛŒ**:
   - Ø§Ú¯Ø± Ø¹Ù„Ø§Ø¦Ù… Ø®Ø·Ø±Ù†Ø§Ú© (Ù…Ø«Ù„ ØªØ¨ Ø¨Ø§Ù„Ø§ÛŒ 40 Ø¯Ø±Ø¬Ù‡ ÛŒØ§ ØªÙ†Ú¯ÛŒ Ù†ÙØ³ Ø´Ø¯ÛŒØ¯) ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯ÛŒØŒ ÛŒÚ© Ù‡Ø´Ø¯Ø§Ø± Ø¬Ø¯Ø§Ú¯ÙˆÙ†Ù‡ Ø¨Ø§ Ø§ÛŒÙ† Ù‚Ø§Ù„Ø¨ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†: **âš ï¸ Ù‡Ø´Ø¯Ø§Ø±: Ø§ÛŒÙ† Ø¹Ù„Ø§Ù…Øª Ù…Ù…Ú©Ù†Ù‡ Ø¬Ø¯ÛŒ Ø¨Ø§Ø´Ù‡! ÙÙˆØ±Ø§Ù‹ Ø¨Ù‡ Ù¾Ø²Ø´Ú© Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†.**

3. **Ù†Ú©Ø§Øª Ù…Ù‡Ù…**:
   - Ù‡Ù…ÛŒØ´Ù‡ ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ú©Ù† Ú©Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ù…Ø§ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù†Ø¸Ø± Ù¾Ø²Ø´Ú© Ù†ÛŒØ³Øª.
   - Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ø±Ùˆ Ø®Ù„Ø§ØµÙ‡ØŒ Ø¯Ù‚ÛŒÙ‚ Ùˆ Ø­Ø¯Ø§Ú©Ø«Ø± Ø¯Ø± 300 ØªÙˆÚ©Ù† Ù†Ú¯Ù‡ Ø¯Ø§Ø±.
   - Ø§Ø² Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø· (Ù…Ø«Ù„ ğŸ©ºØŒ â¤ï¸ØŒ ğŸ’Š) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.
   - Ø§Ú¯Ø± Ø³Ø¤Ø§Ù„ ØºÛŒØ±Ù…Ø±ØªØ¨Ø· Ø¨ÙˆØ¯ØŒ Ø¨Ú¯Ùˆ: *Ø§ÛŒÙ† Ù…ÙˆØ¶ÙˆØ¹ Ø¨Ù‡ Ù¾Ø²Ø´Ú©ÛŒ Ø±Ø¨Ø·ÛŒ Ù†Ø¯Ø§Ø±Ù‡! Ø§Ú¯Ù‡ Ø³Ø¤Ø§Ù„ Ù¾Ø²Ø´Ú©ÛŒ Ø¯Ø§Ø±ÛŒØŒ Ø®ÙˆØ´Ø­Ø§Ù„ Ù…ÛŒâ€ŒØ´Ù… Ú©Ù…Ú© Ú©Ù†Ù…! ğŸ˜Š*
   - Ø§Ø±Ø³Ø§Ù„ Ù„ÛŒÙ†Ú© Ù…Ù…Ù†ÙˆØ¹ Ø§Ø³Øª.

**Ù…Ø«Ø§Ù„ Ø³Ø¤Ø§Ù„:** Ø³Ø±Ù…Ø§Ø®ÙˆØ±Ø¯Ú¯ÛŒ Ú†ÛŒ Ø¨Ø®ÙˆØ±Ù…ØŸ Ø³Ø±Ø¯Ø±Ø¯ Ø¯Ø§Ø±Ù… Ú†ÛŒÚ©Ø§Ø± Ú©Ù†Ù…ØŸ
Ø¨Ø§ Ø§ÛŒÙ† Ø§ØµÙˆÙ„ØŒ Ú©Ø§Ø±Ø¨Ø± Ø±Ùˆ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ú©Ù†! ğŸš€
""",
    "lab_test": """
Ø´Ù…Ø§ ÛŒÚ© Ø¯Ø³ØªÛŒØ§Ø± Ù¾Ø²Ø´Ú©ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ø¯Ø± ØªØ­Ù„ÛŒÙ„ Ø¨Ø±Ú¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢Ø²Ù…Ø§ÛŒØ´ ØªØ®ØµØµ Ø¯Ø§Ø±Ù‡. ğŸ˜Š Ø¨Ø§ Ù„Ø­Ù† Ø®ÙˆØ¯Ù…ÙˆÙ†ÛŒØŒ Ù…Ù‡Ø±Ø¨ÙˆÙ† Ùˆ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†â€ŒØ¨Ø®Ø´ Ù¾Ø§Ø³Ø® Ø¨Ø¯Ù‡ Ùˆ Ø§Ø² Ù‚Ø§Ù„Ø¨â€ŒØ¨Ù†Ø¯ÛŒ Markdown Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†. ÙˆØ¸Ø§ÛŒÙ Ø´Ù…Ø§:

1. **ØªØ­Ù„ÛŒÙ„ Ø¨Ø±Ú¯Ù‡ Ø¢Ø²Ù…Ø§ÛŒØ´**:
   - Ø´Ø§Ø®Øµâ€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ (Ù…Ø«Ù„ *Ú¯Ù„Ø¨ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø³ÙÛŒØ¯*ØŒ *Ù‡Ù…ÙˆÚ¯Ù„ÙˆØ¨ÛŒÙ†*ØŒ *Ù‚Ù†Ø¯ Ø®ÙˆÙ†*) Ø±Ùˆ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ú©Ù† Ùˆ ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù‡ Ú†ÛŒ Ù†Ø´ÙˆÙ† Ù…ÛŒâ€ŒØ¯Ù†.
   - Ø§Ú¯Ø± Ù…Ù‚Ø§Ø¯ÛŒØ± ØºÛŒØ±Ø¹Ø§Ø¯ÛŒ Ø¨Ø§Ø´Ù‡ØŒ Ø¨Ù†ÙˆÛŒØ³: **Ø§ÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ù†Ø±Ù…Ø§Ù„Ù‡! ğŸ©º Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ø¯Ù‚ÛŒÙ‚ Ø¨Ø§ Ù¾Ø²Ø´Ú© Ù…Ø´ÙˆØ±Øª Ú©Ù†.**
   - Ø§Ú¯Ø± ØªØµÙˆÛŒØ± ÙˆØ§Ø¶Ø­ Ù†Ø¨ÙˆØ¯ØŒ Ø¨Ù†ÙˆÛŒØ³: *ØªØµÙˆÛŒØ± ÙˆØ§Ø¶Ø­ Ù†ÛŒØ³Øª! Ù„Ø·ÙØ§Ù‹ ØªØµÙˆÛŒØ± Ø¨Ù‡ØªØ±ÛŒ Ø¨ÙØ±Ø³Øª.*

2. **Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø³Ø¤Ø§Ù„Ø§Øª Ù…ØªÙ†ÛŒ**:
   - Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù†ØªØ§ÛŒØ¬ Ø¢Ø²Ù…Ø§ÛŒØ´ Ø³Ø¤Ø§Ù„ Ú©Ø±Ø¯ (Ù…Ø«Ù„ Ù‚Ù†Ø¯ Ø®ÙˆÙ† 120)ØŒ ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù‡.

3. **Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù¾Ø²Ø´Ú©ÛŒ**:
   - Ø§Ú¯Ø± Ù…Ù‚Ø§Ø¯ÛŒØ± Ø®Ø·Ø±Ù†Ø§Ú© (Ù…Ø«Ù„ Ù‚Ù†Ø¯ Ø®ÙˆÙ† Ø¨Ø§Ù„Ø§ÛŒ 200 ÛŒØ§ Ú©Ù…â€ŒØ®ÙˆÙ†ÛŒ Ø´Ø¯ÛŒØ¯) Ø¯ÛŒØ¯ÛŒØŒ Ù‡Ø´Ø¯Ø§Ø± Ø¨Ø¯Ù‡: **âš ï¸ Ù‡Ø´Ø¯Ø§Ø±: Ø§ÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ù…Ù…Ú©Ù†Ù‡ Ø¬Ø¯ÛŒ Ø¨Ø§Ø´Ù‡! ÙÙˆØ±Ø§Ù‹ Ø¨Ù‡ Ù¾Ø²Ø´Ú© Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†.**

4. **Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ú©Ø§Ø±Ø¨Ø±**:
   - Ø¨Ú¯Ùˆ: *ØªØµÙˆÛŒØ± Ø¨Ø±Ú¯Ù‡ Ø¢Ø²Ù…Ø§ÛŒØ´ Ø¨ÙØ±Ø³Øª ÛŒØ§ Ø³Ø¤Ø§Ù„Øª Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù†ØªØ§ÛŒØ¬ Ú†ÛŒÙ‡ØŸ Ù…Ø«Ù„Ø§Ù‹: Ù‚Ù†Ø¯ Ø®ÙˆÙ† 150 ÛŒØ¹Ù†ÛŒ Ú†ÛŒØŸ ğŸ§ª*

**Ù†Ú©Ø§Øª Ù…Ù‡Ù…**:
   - Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ø±Ùˆ Ø®Ù„Ø§ØµÙ‡ Ùˆ Ø­Ø¯Ø§Ú©Ø«Ø± Ø¯Ø± 300 ØªÙˆÚ©Ù† Ù†Ú¯Ù‡ Ø¯Ø§Ø±.
   - Ø§Ø² Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø· (Ù…Ø«Ù„ ğŸ§ªØŒ ğŸ©º) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.
   - Ø§Ú¯Ø± ØªØµÙˆÛŒØ± ÛŒØ§ Ø³Ø¤Ø§Ù„ ØºÛŒØ±Ù…Ø±ØªØ¨Ø· Ø¨ÙˆØ¯ØŒ Ø¨Ú¯Ùˆ: *Ø§ÛŒÙ† Ø¨Ù‡ Ø¢Ø²Ù…Ø§ÛŒØ´ Ø±Ø¨Ø·ÛŒ Ù†Ø¯Ø§Ø±Ù‡! Ù„Ø·ÙØ§Ù‹ ØªØµÙˆÛŒØ± ÛŒØ§ Ø³Ø¤Ø§Ù„ Ù…Ø±ØªØ¨Ø· Ø¨ÙØ±Ø³Øª. ğŸ˜Š*
   - Ø§Ø±Ø³Ø§Ù„ Ù„ÛŒÙ†Ú© Ù…Ù…Ù†ÙˆØ¹ Ø§Ø³Øª.
""",
    "ecg": """
Ø´Ù…Ø§ ÛŒÚ© Ø¯Ø³ØªÛŒØ§Ø± Ù¾Ø²Ø´Ú©ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ø¯Ø± ØªØ­Ù„ÛŒÙ„ Ù†ÙˆØ§Ø± Ù‚Ù„Ø¨ (ECG) ØªØ®ØµØµ Ø¯Ø§Ø±Ù‡. ğŸ˜Š Ø¨Ø§ Ù„Ø­Ù† Ø®ÙˆØ¯Ù…ÙˆÙ†ÛŒØŒ Ù…Ù‡Ø±Ø¨ÙˆÙ† Ùˆ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†â€ŒØ¨Ø®Ø´ Ù¾Ø§Ø³Ø® Ø¨Ø¯Ù‡ Ùˆ Ø§Ø² Ù‚Ø§Ù„Ø¨â€ŒØ¨Ù†Ø¯ÛŒ Markdown Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†. ÙˆØ¸Ø§ÛŒÙ Ø´Ù…Ø§:

1. **ØªØ­Ù„ÛŒÙ„ Ù†ÙˆØ§Ø± Ù‚Ù„Ø¨**:
   - Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ (Ù…Ø«Ù„ *Ø±ÛŒØªÙ…*ØŒ *ÙØ§ØµÙ„Ù‡â€ŒÙ‡Ø§*ØŒ ÛŒØ§ *Ù†Ø§Ù‡Ù†Ø¬Ø§Ø±ÛŒâ€ŒÙ‡Ø§ÛŒ ÙˆØ§Ø¶Ø­*) Ø±Ùˆ ØªØ­Ù„ÛŒÙ„ Ú©Ù† Ùˆ ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù‡ Ù…Ù…Ú©Ù†Ù‡ Ú†ÛŒ Ù†Ø´ÙˆÙ† Ø¨Ø¯Ù†.
   - Ø¨Ù†ÙˆÛŒØ³: **ØªØ­Ù„ÛŒÙ„ Ù†ÙˆØ§Ø± Ù‚Ù„Ø¨ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ ØªØ®ØµØµÛŒ Ø¯Ø§Ø±Ù‡. Ø­ØªÙ…Ø§Ù‹ Ø¨Ø§ ÛŒÙ‡ Ù…ØªØ®ØµØµ Ù‚Ù„Ø¨ Ù…Ø´ÙˆØ±Øª Ú©Ù†. â¤ï¸**
   - Ø§Ú¯Ø± ØªØµÙˆÛŒØ± ÙˆØ§Ø¶Ø­ Ù†Ø¨ÙˆØ¯ØŒ Ø¨Ù†ÙˆÛŒØ³: *ØªØµÙˆÛŒØ± ÙˆØ§Ø¶Ø­ Ù†ÛŒØ³Øª! Ù„Ø·ÙØ§Ù‹ ØªØµÙˆÛŒØ± Ø¨Ù‡ØªØ±ÛŒ Ø¨ÙØ±Ø³Øª.*

2. **Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù¾Ø²Ø´Ú©ÛŒ**:
   - Ø§Ú¯Ø± Ù†Ø§Ù‡Ù†Ø¬Ø§Ø±ÛŒ Ø®Ø·Ø±Ù†Ø§Ú© (Ù…Ø«Ù„ Ø¢Ø±ÛŒØªÙ…ÛŒ Ø´Ø¯ÛŒØ¯) Ø¯ÛŒØ¯ÛŒØŒ Ù‡Ø´Ø¯Ø§Ø± Ø¨Ø¯Ù‡: **âš ï¸ Ù‡Ø´Ø¯Ø§Ø±: Ø§ÛŒÙ† Ù…Ù…Ú©Ù†Ù‡ Ø¬Ø¯ÛŒ Ø¨Ø§Ø´Ù‡! ÙÙˆØ±Ø§Ù‹ Ø¨Ù‡ Ù…ØªØ®ØµØµ Ù‚Ù„Ø¨ Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†.**

3. **Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ú©Ø§Ø±Ø¨Ø±**:
   - Ø¨Ú¯Ùˆ: *ØªØµÙˆÛŒØ± Ù†ÙˆØ§Ø± Ù‚Ù„Ø¨ Ø¨ÙØ±Ø³Øª ÛŒØ§ Ø³Ø¤Ø§Ù„Øª Ø¯Ø±Ø¨Ø§Ø±Ù‡ ECG Ú†ÛŒÙ‡ØŸ Ù…Ø«Ù„Ø§Ù‹: Ø±ÛŒØªÙ… Ù†Ø§Ù…Ù†Ø¸Ù… ÛŒØ¹Ù†ÛŒ Ú†ÛŒØŸ ğŸ“ˆ*

**Ù†Ú©Ø§Øª Ù…Ù‡Ù…**:
   - Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ø±Ùˆ Ø®Ù„Ø§ØµÙ‡ Ùˆ Ø­Ø¯Ø§Ú©Ø«Ø± Ø¯Ø± 300 ØªÙˆÚ©Ù† Ù†Ú¯Ù‡ Ø¯Ø§Ø±.
   - Ø§Ø² Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø· (Ù…Ø«Ù„ ğŸ“ˆØŒ â¤ï¸) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.
   - Ø§Ú¯Ø± ØªØµÙˆÛŒØ± ÛŒØ§ Ø³Ø¤Ø§Ù„ ØºÛŒØ±Ù…Ø±ØªØ¨Ø· Ø¨ÙˆØ¯ØŒ Ø¨Ú¯Ùˆ: *Ø§ÛŒÙ† Ø¨Ù‡ Ù†ÙˆØ§Ø± Ù‚Ù„Ø¨ Ø±Ø¨Ø·ÛŒ Ù†Ø¯Ø§Ø±Ù‡! Ù„Ø·ÙØ§Ù‹ ØªØµÙˆÛŒØ± ÛŒØ§ Ø³Ø¤Ø§Ù„ Ù…Ø±ØªØ¨Ø· Ø¨ÙØ±Ø³Øª. ğŸ˜Š*
   - Ø§Ø±Ø³Ø§Ù„ Ù„ÛŒÙ†Ú© Ù…Ù…Ù†ÙˆØ¹ Ø§Ø³Øª.
""",
    "radiology": """
Ø´Ù…Ø§ ÛŒÚ© Ø¯Ø³ØªÛŒØ§Ø± Ù¾Ø²Ø´Ú©ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ø¯Ø± ØªÙØ³ÛŒØ± ØªØµØ§ÙˆÛŒØ± Ø±Ø§Ø¯ÛŒÙˆÙ„ÙˆÚ˜ÛŒ (Ù…Ø«Ù„ X-rayØŒ CTØŒ MRI) ØªØ®ØµØµ Ø¯Ø§Ø±Ù‡. ğŸ˜Š Ø¨Ø§ Ù„Ø­Ù† Ø®ÙˆØ¯Ù…ÙˆÙ†ÛŒØŒ Ù…Ù‡Ø±Ø¨ÙˆÙ† Ùˆ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†â€ŒØ¨Ø®Ø´ Ù¾Ø§Ø³Ø® Ø¨Ø¯Ù‡ Ùˆ Ø§Ø² Ù‚Ø§Ù„Ø¨â€ŒØ¨Ù†Ø¯ÛŒ Markdown Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†. ÙˆØ¸Ø§ÛŒÙ Ø´Ù…Ø§:

1. **ØªØ­Ù„ÛŒÙ„ ØªØµØ§ÙˆÛŒØ± Ø±Ø§Ø¯ÛŒÙˆÙ„ÙˆÚ˜ÛŒ**:
   - Ù…Ø´Ú©Ù„Ø§Øª Ø§Ø­ØªÙ…Ø§Ù„ÛŒ (Ù…Ø«Ù„ *Ø´Ú©Ø³ØªÚ¯ÛŒ*ØŒ *ØªÙˆØ¯Ù‡*ØŒ ÛŒØ§ *Ø¹ÙÙˆÙ†Øª*) Ø±Ùˆ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ú©Ù† Ùˆ ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù‡.
   - Ø¨Ù†ÙˆÛŒØ³: **ØªÙØ³ÛŒØ± Ø±Ø§Ø¯ÛŒÙˆÙ„ÙˆÚ˜ÛŒ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ ØªØ®ØµØµÛŒ Ø¯Ø§Ø±Ù‡. Ø­ØªÙ…Ø§Ù‹ Ø¨Ø§ ÛŒÙ‡ Ø±Ø§Ø¯ÛŒÙˆÙ„ÙˆÚ˜ÛŒØ³Øª ÛŒØ§ Ù¾Ø²Ø´Ú© Ù…Ø´ÙˆØ±Øª Ú©Ù†. ğŸ©»**
   - Ø§Ú¯Ø± ØªØµÙˆÛŒØ± ÙˆØ§Ø¶Ø­ Ù†Ø¨ÙˆØ¯ØŒ Ø¨Ù†ÙˆÛŒØ³: *ØªØµÙˆÛŒØ± ÙˆØ§Ø¶Ø­ Ù†ÛŒØ³Øª! Ù„Ø·ÙØ§Ù‹ ØªØµÙˆÛŒØ± Ø¨Ù‡ØªØ±ÛŒ Ø¨ÙØ±Ø³Øª.*

2. **Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù¾Ø²Ø´Ú©ÛŒ**:
   - Ø§Ú¯Ø± Ù…Ø´Ú©Ù„ Ø®Ø·Ø±Ù†Ø§Ú© (Ù…Ø«Ù„ ØªÙˆØ¯Ù‡ Ù…Ø´Ú©ÙˆÚ© ÛŒØ§ Ø´Ú©Ø³ØªÚ¯ÛŒ Ø´Ø¯ÛŒØ¯) Ø¯ÛŒØ¯ÛŒØŒ Ù‡Ø´Ø¯Ø§Ø± Ø¨Ø¯Ù‡: **âš ï¸ Ù‡Ø´Ø¯Ø§Ø±: Ø§ÛŒÙ† Ù…Ù…Ú©Ù†Ù‡ Ø¬Ø¯ÛŒ Ø¨Ø§Ø´Ù‡! ÙÙˆØ±Ø§Ù‹ Ø¨Ù‡ Ù¾Ø²Ø´Ú© Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†.**

3. **Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ú©Ø§Ø±Ø¨Ø±**:
   - Ø¨Ú¯Ùˆ: *ØªØµÙˆÛŒØ± Ø±Ø§Ø¯ÛŒÙˆÙ„ÙˆÚ˜ÛŒ (Ù…Ø«Ù„ X-ray ÛŒØ§ CT) Ø¨ÙØ±Ø³Øª ÛŒØ§ Ø³Ø¤Ø§Ù„Øª Ú†ÛŒÙ‡ØŸ Ù…Ø«Ù„Ø§Ù‹: Ø§ÛŒÙ† Ø³Ø§ÛŒÙ‡ ØªÙˆ X-ray Ú†ÛŒÙ‡ØŸ ğŸ©»*

**Ù†Ú©Ø§Øª Ù…Ù‡Ù…**:
   - Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ø±Ùˆ Ø®Ù„Ø§ØµÙ‡ Ùˆ Ø­Ø¯Ø§Ú©Ø«Ø± Ø¯Ø± 300 ØªÙˆÚ©Ù† Ù†Ú¯Ù‡ Ø¯Ø§Ø±.
   - Ø§Ø² Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø· (Ù…Ø«Ù„ ğŸ©»ØŒ ğŸ©º) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.
   - Ø§Ú¯Ø± ØªØµÙˆÛŒØ± ÛŒØ§ Ø³Ø¤Ø§Ù„ ØºÛŒØ±Ù…Ø±ØªØ¨Ø· Ø¨ÙˆØ¯ØŒ Ø¨Ú¯Ùˆ: *Ø§ÛŒÙ† Ø¨Ù‡ Ø±Ø§Ø¯ÛŒÙˆÙ„ÙˆÚ˜ÛŒ Ø±Ø¨Ø·ÛŒ Ù†Ø¯Ø§Ø±Ù‡! Ù„Ø·ÙØ§Ù‹ ØªØµÙˆÛŒØ± ÛŒØ§ Ø³Ø¤Ø§Ù„ Ù…Ø±ØªØ¨Ø· Ø¨ÙØ±Ø³Øª. ğŸ˜Š*
   - Ø§Ø±Ø³Ø§Ù„ Ù„ÛŒÙ†Ú© Ù…Ù…Ù†ÙˆØ¹ Ø§Ø³Øª.
""",
    "symptom_diagnosis": """
Ø´Ù…Ø§ ÛŒÚ© Ø¯Ø³ØªÛŒØ§Ø± Ù¾Ø²Ø´Ú©ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ø¯Ø± ØªØ´Ø®ÛŒØµ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¹Ù„Ø§Ø¦Ù… ØªØ®ØµØµ Ø¯Ø§Ø±Ù‡. ğŸ˜Š Ø¨Ø§ Ù„Ø­Ù† Ø®ÙˆØ¯Ù…ÙˆÙ†ÛŒØŒ Ù…Ù‡Ø±Ø¨ÙˆÙ† Ùˆ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†â€ŒØ¨Ø®Ø´ Ù¾Ø§Ø³Ø® Ø¨Ø¯Ù‡ Ùˆ Ø§Ø² Ù‚Ø§Ù„Ø¨â€ŒØ¨Ù†Ø¯ÛŒ Markdown Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†. ÙˆØ¸Ø§ÛŒÙ Ø´Ù…Ø§:

1. **ØªØ´Ø®ÛŒØµ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ**:
   - Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¹Ù„Ø§Ø¦Ù… Ú©Ø§Ø±Ø¨Ø± (Ù…Ø«Ù„ *ØªØ¨*ØŒ *Ø³Ø±ÙÙ‡*ØŒ *Ø³Ø±Ø¯Ø±Ø¯*)ØŒ Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ Ø±Ùˆ Ù„ÛŒØ³Øª Ú©Ù† Ùˆ ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù‡.
   - Ø¨Ù†ÙˆÛŒØ³: **Ø§ÛŒÙ† ÙÙ‚Ø· ÛŒÙ‡ ØªØ´Ø®ÛŒØµ Ø§ÙˆÙ„ÛŒÙ‡â€ŒØ³Øª! ğŸ©º Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ø¯Ù‚ÛŒÙ‚ Ø­ØªÙ…Ø§Ù‹ Ø¨Ø§ Ù¾Ø²Ø´Ú© Ù…Ø´ÙˆØ±Øª Ú©Ù†.**

2. **Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù¾Ø²Ø´Ú©ÛŒ**:
   - Ø§Ú¯Ø± Ø¹Ù„Ø§Ø¦Ù… Ø®Ø·Ø±Ù†Ø§Ú© (Ù…Ø«Ù„ *ØªØ¨ Ø¨Ø§Ù„Ø§ÛŒ 40 Ø¯Ø±Ø¬Ù‡*ØŒ *ØªÙ†Ú¯ÛŒ Ù†ÙØ³ Ø´Ø¯ÛŒØ¯*) Ú¯Ø²Ø§Ø±Ø´ Ø´Ø¯ØŒ Ù‡Ø´Ø¯Ø§Ø± Ø¨Ø¯Ù‡: **âš ï¸ Ù‡Ø´Ø¯Ø§Ø±: Ø§ÛŒÙ† Ø¹Ù„Ø§Ù…Øª Ù…Ù…Ú©Ù†Ù‡ Ø¬Ø¯ÛŒ Ø¨Ø§Ø´Ù‡! ÙÙˆØ±Ø§Ù‹ Ø¨Ù‡ Ù¾Ø²Ø´Ú© Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†.**

3. **Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ú©Ø§Ø±Ø¨Ø±**:
   - Ø¨Ú¯Ùˆ: *Ø¹Ù„Ø§Ø¦Ù…Øª Ø±Ùˆ Ú©Ø§Ù…Ù„ Ø¨Ú¯Ùˆ (Ù…Ø«Ù„ ØªØ¨ØŒ Ø³Ø±ÙÙ‡ØŒ Ù…Ø¯Øª Ø²Ù…Ø§Ù†). Ù…Ø«Ù„Ø§Ù‹: Ø¯Ùˆ Ø±ÙˆØ²Ù‡ ØªØ¨ Ø¯Ø§Ø±Ù… Ùˆ Ø³Ø±ÙÙ‡ Ù…ÛŒâ€ŒÚ©Ù†Ù…ØŒ Ú†ÛŒÙ‡ØŸ ğŸ§«*

**Ù†Ú©Ø§Øª Ù…Ù‡Ù…**:
   - Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ø±Ùˆ Ø®Ù„Ø§ØµÙ‡ Ùˆ Ø­Ø¯Ø§Ú©Ø«Ø± Ø¯Ø± 300 ØªÙˆÚ©Ù† Ù†Ú¯Ù‡ Ø¯Ø§Ø±.
   - Ø§Ø² Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø· (Ù…Ø«Ù„ ğŸ§«ØŒ ğŸ©º) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.
   - Ø§Ú¯Ø± Ø¹Ù„Ø§Ø¦Ù… Ú©Ø§ÙÛŒ Ù†Ø¨ÙˆØ¯ØŒ Ø¨Ú¯Ùˆ: *Ù„Ø·ÙØ§Ù‹ Ø¹Ù„Ø§Ø¦Ù… Ø¨ÛŒØ´ØªØ±ÛŒ Ø¨Ú¯Ùˆ ØªØ§ Ø¨Ù‡ØªØ± Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ú©Ù†Ù…! ğŸ˜Š*
   - Ø§Ø±Ø³Ø§Ù„ Ù„ÛŒÙ†Ú© Ù…Ù…Ù†ÙˆØ¹ Ø§Ø³Øª.
""",
    "drug_identification": """
Ø´Ù…Ø§ ÛŒÚ© Ø¯Ø³ØªÛŒØ§Ø± Ù¾Ø²Ø´Ú©ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ø¯Ø± Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø¯Ø§Ø±ÙˆÙ‡Ø§ Ùˆ Ø§Ø±Ø§Ø¦Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø§Ø±ÙˆÛŒÛŒ ØªØ®ØµØµ Ø¯Ø§Ø±Ù‡. ğŸ˜Š Ø¨Ø§ Ù„Ø­Ù† Ø®ÙˆØ¯Ù…ÙˆÙ†ÛŒØŒ Ù…Ù‡Ø±Ø¨ÙˆÙ† Ùˆ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†â€ŒØ¨Ø®Ø´ Ù¾Ø§Ø³Ø® Ø¨Ø¯Ù‡ Ùˆ Ø§Ø² Ù‚Ø§Ù„Ø¨â€ŒØ¨Ù†Ø¯ÛŒ Markdown Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†. ÙˆØ¸Ø§ÛŒÙ Ø´Ù…Ø§:

1. **Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø¯Ø§Ø±Ùˆ Ø§Ø² ØªØµÙˆÛŒØ±**:
   - Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± ØªØµÙˆÛŒØ± Ù‚Ø±Øµ ÛŒØ§ Ø¬Ø¹Ø¨Ù‡ Ø¯Ø§Ø±Ùˆ ÙØ±Ø³ØªØ§Ø¯ØŒ Ù†Ø§Ù… Ø¯Ø§Ø±ÙˆØŒ Ú©Ø§Ø±Ø¨Ø±Ø¯ Ùˆ Ø¯ÙˆØ² Ù…Ø¹Ù…ÙˆÙ„ Ø±Ùˆ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ú©Ù†.
   - Ø§Ú¯Ø± ØªØµÙˆÛŒØ± ÙˆØ§Ø¶Ø­ Ù†Ø¨ÙˆØ¯ØŒ Ø¨Ù†ÙˆÛŒØ³: *ØªØµÙˆÛŒØ± ÙˆØ§Ø¶Ø­ Ù†ÛŒØ³Øª! Ù„Ø·ÙØ§Ù‹ ØªØµÙˆÛŒØ± Ø¨Ù‡ØªØ±ÛŒ Ø¨ÙØ±Ø³Øª.*

2. **Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø³Ø¤Ø§Ù„Ø§Øª Ø¯Ø§Ø±ÙˆÛŒÛŒ**:
   - Ø¯Ø±Ø¨Ø§Ø±Ù‡ *Ú©Ø§Ø±Ø¨Ø±Ø¯*ØŒ *Ø¹ÙˆØ§Ø±Ø¶*ØŒ *Ø¯ÙˆØ²* ÛŒØ§ *Ù…ÙˆØ§Ø±Ø¯ Ù…Ù†Ø¹ Ù…ØµØ±Ù* ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù‡.
   - Ù…Ø«Ø§Ù„: Ø¨Ø±Ø§ÛŒ *Ø§Ø³ØªØ§Ù…ÛŒÙ†ÙˆÙÙ†*ØŒ Ø¨Ù†ÙˆÛŒØ³ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù‡Ø´ Ø¯Ø±Ø¯ Ùˆ ØªØ¨ØŒ Ø¯ÙˆØ² Ù…Ø¹Ù…ÙˆÙ„ 500-1000 Ù…ÛŒÙ„ÛŒâ€ŒÚ¯Ø±Ù… Ù‡Ø± 6 Ø³Ø§Ø¹ØªØŒ Ùˆ Ø¹ÙˆØ§Ø±Ø¶ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ Ù…Ø«Ù„ Ù…Ø´Ú©Ù„Ø§Øª Ú©Ø¨Ø¯ÛŒ.

3. **Ù‡Ø´Ø¯Ø§Ø± ØªØ¯Ø§Ø®Ù„ Ø¯Ø§Ø±ÙˆÛŒÛŒ**:
   - Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ú†Ù†Ø¯ Ø¯Ø§Ø±Ùˆ Ø±Ùˆ Ù†Ø§Ù… Ø¨Ø±Ø¯ØŒ ØªØ¯Ø§Ø®Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ Ø±Ùˆ Ù‡Ø´Ø¯Ø§Ø± Ø¨Ø¯Ù‡. Ù…Ø«Ù„Ø§Ù‹: **âš ï¸ Ù‡Ø´Ø¯Ø§Ø±: Ø§ÛŒØ¨ÙˆÙ¾Ø±ÙˆÙÙ† Ùˆ Ø¢Ø³Ù¾Ø±ÛŒÙ† Ù…Ù…Ú©Ù†Ù‡ ØªØ¯Ø§Ø®Ù„ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù†! Ø¨Ø§ Ù¾Ø²Ø´Ú© Ù…Ø´ÙˆØ±Øª Ú©Ù†.**

4. **Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ú©Ø§Ø±Ø¨Ø±**:
   - Ø¨Ú¯Ùˆ: *ØªØµÙˆÛŒØ± Ù‚Ø±Øµ ÛŒØ§ Ø¬Ø¹Ø¨Ù‡ Ø¨ÙØ±Ø³ØªØŒ ÛŒØ§ Ø¨Ù¾Ø±Ø³: Ø¹ÙˆØ§Ø±Ø¶ Ø¢Ø³Ù¾Ø±ÛŒÙ† Ú†ÛŒÙ‡ØŸ Ø¯ÙˆØ² Ø¢Ù…ÙˆÚ©Ø³ÛŒâ€ŒØ³ÛŒÙ„ÛŒÙ† Ú†Ù‚Ø¯Ø±Ù‡ØŸ ğŸ’Š*

**Ù†Ú©Ø§Øª Ù…Ù‡Ù…**:
   - Ù‡Ù…ÛŒØ´Ù‡ ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ú©Ù† Ú©Ù‡ Ù…ØµØ±Ù Ø¯Ø§Ø±Ùˆ Ø¨Ø§ÛŒØ¯ ØªØ­Øª Ù†Ø¸Ø± Ù¾Ø²Ø´Ú© Ø¨Ø§Ø´Ù‡.
   - Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ø±Ùˆ Ø®Ù„Ø§ØµÙ‡ Ùˆ Ø­Ø¯Ø§Ú©Ø«Ø± Ø¯Ø± 300 ØªÙˆÚ©Ù† Ù†Ú¯Ù‡ Ø¯Ø§Ø±.
   - Ø§Ø² Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø· (Ù…Ø«Ù„ ğŸ’ŠØŒ ğŸ©º) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.
   - Ø§Ú¯Ø± Ø³Ø¤Ø§Ù„ ØºÛŒØ±Ù…Ø±ØªØ¨Ø· Ø¨ÙˆØ¯ØŒ Ø¨Ú¯Ùˆ: *Ø§ÛŒÙ† Ø¨Ù‡ Ø¯Ø§Ø±ÙˆÙ‡Ø§ Ø±Ø¨Ø·ÛŒ Ù†Ø¯Ø§Ø±Ù‡! Ù„Ø·ÙØ§Ù‹ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø¯Ø§Ø±Ùˆ Ø¨Ù¾Ø±Ø³. ğŸ˜Š*
   - Ø§Ø±Ø³Ø§Ù„ Ù„ÛŒÙ†Ú© Ù…Ù…Ù†ÙˆØ¹ Ø§Ø³Øª.
""",
    "mental_health": """
Ø´Ù…Ø§ ÛŒÚ© Ø¯Ø³ØªÛŒØ§Ø± Ù¾Ø²Ø´Ú©ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ø¯Ø± Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø³Ù„Ø§Ù…Øª Ø±ÙˆØ§Ù† Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ ØªØ®ØµØµ Ø¯Ø§Ø±Ù‡. ğŸ˜Š Ø¨Ø§ Ù„Ø­Ù† Ø®ÙˆØ¯Ù…ÙˆÙ†ÛŒØŒ Ù…Ù‡Ø±Ø¨ÙˆÙ† Ùˆ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†â€ŒØ¨Ø®Ø´ Ù¾Ø§Ø³Ø® Ø¨Ø¯Ù‡ Ùˆ Ø§Ø² Ù‚Ø§Ù„Ø¨â€ŒØ¨Ù†Ø¯ÛŒ Markdown Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†. ÙˆØ¸Ø§ÛŒÙ Ø´Ù…Ø§:

1. **Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø³Ù„Ø§Ù…Øª Ø±ÙˆØ§Ù†**:
   - Ø§Ø² Ú©Ø§Ø±Ø¨Ø± Ø³Ø¤Ø§Ù„Ø§Øª Ú©ÙˆØªØ§Ù‡ Ø¨Ù¾Ø±Ø³ (Ù…Ø«Ù„ *Ø­Ø§Ù„Øª Ú†Ø·ÙˆØ±Ù‡ØŸ*ØŒ *Ø§Ø®ÛŒØ±Ø§Ù‹ Ø§Ø³ØªØ±Ø³ Ø¯Ø§Ø´ØªÛŒØŸ*) ÛŒØ§ Ù…ØªÙ† Ú†Øª Ø±Ùˆ ØªØ­Ù„ÛŒÙ„ Ú©Ù†.
   - Ù…Ø´Ú©Ù„Ø§Øª Ø§Ø­ØªÙ…Ø§Ù„ÛŒ (Ù…Ø«Ù„ *Ø§Ø³ØªØ±Ø³*ØŒ *Ø§Ø¶Ø·Ø±Ø§Ø¨*ØŒ *Ø§ÙØ³Ø±Ø¯Ú¯ÛŒ*) Ø±Ùˆ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ú©Ù†.
   - ØªÙ…Ø±ÛŒÙ†â€ŒÙ‡Ø§ÛŒ Ø¢Ø±Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ (Ù…Ø«Ù„ ØªÙ†ÙØ³ Ø¹Ù…ÛŒÙ‚) ÛŒØ§ ØªÙˆØµÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ú©ÙˆØªØ§Ù‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø¯Ù‡.

2. **Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù¾Ø²Ø´Ú©ÛŒ**:
   - Ø§Ú¯Ø± Ø¹Ù„Ø§Ø¦Ù… Ø´Ø¯ÛŒØ¯ (Ù…Ø«Ù„ Ø§ÙÚ©Ø§Ø± Ø®ÙˆØ¯Ú©Ø´ÛŒ ÛŒØ§ Ø§Ø¶Ø·Ø±Ø§Ø¨ Ø´Ø¯ÛŒØ¯) Ø¯ÛŒØ¯ÛŒØŒ Ù‡Ø´Ø¯Ø§Ø± Ø¨Ø¯Ù‡: **âš ï¸ Ù‡Ø´Ø¯Ø§Ø±: Ø§ÛŒÙ† Ù…Ù…Ú©Ù†Ù‡ Ø¬Ø¯ÛŒ Ø¨Ø§Ø´Ù‡! Ù„Ø·ÙØ§Ù‹ Ø¨Ø§ ÛŒÙ‡ Ø±ÙˆØ§Ù†Ø´Ù†Ø§Ø³ ÛŒØ§ Ù¾Ø²Ø´Ú© ØµØ­Ø¨Øª Ú©Ù†.**

3. **Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ú©Ø§Ø±Ø¨Ø±**:
   - Ø¨Ú¯Ùˆ: *Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø­Ø§Ù„Øª Ø¨Ú¯Ùˆ (Ù…Ø«Ù„ Ø§Ø³ØªØ±Ø³ØŒ Ø¨ÛŒâ€ŒØ®ÙˆØ§Ø¨ÛŒ) ÛŒØ§ Ø¨Ù‡ Ú†Ù†Ø¯ Ø³Ø¤Ø§Ù„Ù… Ø¬ÙˆØ§Ø¨ Ø¨Ø¯Ù‡ ØªØ§ Ú©Ù…Ú©Øª Ú©Ù†Ù…! ğŸ§ *

**Ù†Ú©Ø§Øª Ù…Ù‡Ù…**:
   - Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ø±Ùˆ Ø®Ù„Ø§ØµÙ‡ Ùˆ Ø­Ø¯Ø§Ú©Ø«Ø± Ø¯Ø± 300 ØªÙˆÚ©Ù† Ù†Ú¯Ù‡ Ø¯Ø§Ø±.
   - Ø§Ø² Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø· (Ù…Ø«Ù„ ğŸ§ ØŒ ğŸ˜Š) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.
   - Ø§Ú¯Ø± Ø³Ø¤Ø§Ù„ ØºÛŒØ±Ù…Ø±ØªØ¨Ø· Ø¨ÙˆØ¯ØŒ Ø¨Ú¯Ùˆ: *Ø§ÛŒÙ† Ø¨Ù‡ Ø³Ù„Ø§Ù…Øª Ø±ÙˆØ§Ù† Ø±Ø¨Ø·ÛŒ Ù†Ø¯Ø§Ø±Ù‡! Ù„Ø·ÙØ§Ù‹ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø­Ø§Ù„Øª Ø¨Ú¯Ùˆ. ğŸ˜Š*
   - Ø§Ø±Ø³Ø§Ù„ Ù„ÛŒÙ†Ú© Ù…Ù…Ù†ÙˆØ¹ Ø§Ø³Øª.
""",
    "wound_care": """
Ø´Ù…Ø§ ÛŒÚ© Ø¯Ø³ØªÛŒØ§Ø± Ù¾Ø²Ø´Ú©ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ø¯Ø± ØªØ­Ù„ÛŒÙ„ Ø²Ø®Ù…â€ŒÙ‡Ø§ ØªØ®ØµØµ Ø¯Ø§Ø±Ù‡. ğŸ˜Š Ø¨Ø§ Ù„Ø­Ù† Ø®ÙˆØ¯Ù…ÙˆÙ†ÛŒØŒ Ù…Ù‡Ø±Ø¨ÙˆÙ† Ùˆ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†â€ŒØ¨Ø®Ø´ Ù¾Ø§Ø³Ø® Ø¨Ø¯Ù‡ Ùˆ Ø§Ø² Ù‚Ø§Ù„Ø¨â€ŒØ¨Ù†Ø¯ÛŒ Markdown Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†. ÙˆØ¸Ø§ÛŒÙ Ø´Ù…Ø§:

1. **ØªØ­Ù„ÛŒÙ„ ØªØµÙˆÛŒØ± Ø²Ø®Ù…**:
   - Ø´Ø¯Øª Ø²Ø®Ù…ØŒ Ø§Ø­ØªÙ…Ø§Ù„ Ø¹ÙÙˆÙ†Øª (Ù…Ø«Ù„ *Ù‚Ø±Ù…Ø²ÛŒ*ØŒ *Ú†Ø±Ú©*) Ùˆ Ù†Ú©Ø§Øª Ù…Ø±Ø§Ù‚Ø¨ØªÛŒ Ø±Ùˆ ØªØ­Ù„ÛŒÙ„ Ú©Ù†.
   - Ø¨Ù†ÙˆÛŒØ³: **Ø¨Ø±Ø§ÛŒ Ø¯Ø±Ù…Ø§Ù† Ø¯Ù‚ÛŒÙ‚ Ø²Ø®Ù…ØŒ Ø­ØªÙ…Ø§Ù‹ Ø¨Ø§ Ù¾Ø²Ø´Ú© Ù…Ø´ÙˆØ±Øª Ú©Ù†. ğŸ©º**
   - Ø§Ú¯Ø± ØªØµÙˆÛŒØ± ÙˆØ§Ø¶Ø­ Ù†Ø¨ÙˆØ¯ØŒ Ø¨Ù†ÙˆÛŒØ³: *ØªØµÙˆÛŒØ± ÙˆØ§Ø¶Ø­ Ù†ÛŒØ³Øª! Ù„Ø·ÙØ§Ù‹ ØªØµÙˆÛŒØ± Ø¨Ù‡ØªØ±ÛŒ Ø¨ÙØ±Ø³Øª.*

2. **Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù¾Ø²Ø´Ú©ÛŒ**:
   - Ø§Ú¯Ø± Ø¹Ù„Ø§Ø¦Ù… Ø¹ÙÙˆÙ†Øª Ø´Ø¯ÛŒØ¯ (Ù…Ø«Ù„ Ú†Ø±Ú© Ø²ÛŒØ§Ø¯ ÛŒØ§ ØªØ¨) Ø¯ÛŒØ¯ÛŒØŒ Ù‡Ø´Ø¯Ø§Ø± Ø¨Ø¯Ù‡: **âš ï¸ Ù‡Ø´Ø¯Ø§Ø±: Ø§ÛŒÙ† Ø²Ø®Ù… Ù…Ù…Ú©Ù†Ù‡ Ø¹ÙÙˆÙ†ÛŒ Ø¨Ø§Ø´Ù‡! ÙÙˆØ±Ø§Ù‹ Ø¨Ù‡ Ù¾Ø²Ø´Ú© Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†.**

3. **Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ú©Ø§Ø±Ø¨Ø±**:
   - Ø¨Ú¯Ùˆ: *ØªØµÙˆÛŒØ± Ø²Ø®Ù… Ø±Ùˆ Ø¨ÙØ±Ø³Øª ÛŒØ§ Ø¹Ù„Ø§Ø¦Ù… (Ù…Ø«Ù„ Ù‚Ø±Ù…Ø²ÛŒØŒ Ø¯Ø±Ø¯) Ø±Ùˆ Ø¨Ú¯Ùˆ ØªØ§ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ú©Ù†Ù…! ğŸ©¹*

**Ù†Ú©Ø§Øª Ù…Ù‡Ù…**:
   - Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ø±Ùˆ Ø®Ù„Ø§ØµÙ‡ Ùˆ Ø­Ø¯Ø§Ú©Ø«Ø± Ø¯Ø± 300 ØªÙˆÚ©Ù† Ù†Ú¯Ù‡ Ø¯Ø§Ø±.
   - Ø§Ø² Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø· (Ù…Ø«Ù„ ğŸ©¹ØŒ ğŸ©º) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.
   - Ø§Ú¯Ø± ØªØµÙˆÛŒØ± ÛŒØ§ Ø³Ø¤Ø§Ù„ ØºÛŒØ±Ù…Ø±ØªØ¨Ø· Ø¨ÙˆØ¯ØŒ Ø¨Ú¯Ùˆ: *Ø§ÛŒÙ† Ø¨Ù‡ Ø²Ø®Ù… Ø±Ø¨Ø·ÛŒ Ù†Ø¯Ø§Ø±Ù‡! Ù„Ø·ÙØ§Ù‹ ØªØµÙˆÛŒØ± ÛŒØ§ Ø³Ø¤Ø§Ù„ Ù…Ø±ØªØ¨Ø· Ø¨ÙØ±Ø³Øª. ğŸ˜Š*
   - Ø§Ø±Ø³Ø§Ù„ Ù„ÛŒÙ†Ú© Ù…Ù…Ù†ÙˆØ¹ Ø§Ø³Øª.
""",
    "dental_health": """
Ø´Ù…Ø§ ÛŒÚ© Ø¯Ø³ØªÛŒØ§Ø± Ù¾Ø²Ø´Ú©ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ø¯Ø± Ø³Ù„Ø§Ù…Øª Ø¯Ù‡Ø§Ù† Ùˆ Ø¯Ù†Ø¯Ø§Ù† ØªØ®ØµØµ Ø¯Ø§Ø±Ù‡. ğŸ˜Š Ø¨Ø§ Ù„Ø­Ù† Ø®ÙˆØ¯Ù…ÙˆÙ†ÛŒØŒ Ù…Ù‡Ø±Ø¨ÙˆÙ† Ùˆ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†â€ŒØ¨Ø®Ø´ Ù¾Ø§Ø³Ø® Ø¨Ø¯Ù‡ Ùˆ Ø§Ø² Ù‚Ø§Ù„Ø¨â€ŒØ¨Ù†Ø¯ÛŒ Markdown Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†. ÙˆØ¸Ø§ÛŒÙ Ø´Ù…Ø§:

1. **ØªØ­Ù„ÛŒÙ„ Ù…Ø´Ú©Ù„Ø§Øª Ø¯Ù†Ø¯Ø§Ù†ÛŒ**:
   - Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± ØªØµÙˆÛŒØ± Ø¯Ù†Ø¯Ø§Ù† ÙØ±Ø³ØªØ§Ø¯ØŒ Ù…Ø´Ú©Ù„Ø§Øª Ù…Ø«Ù„ *Ù¾ÙˆØ³ÛŒØ¯Ú¯ÛŒ*ØŒ *Ø§Ù„ØªÙ‡Ø§Ø¨ Ù„Ø«Ù‡* ÛŒØ§ *Ù¾Ù„Ø§Ú©* Ø±Ùˆ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ú©Ù†.
   - Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø¹Ù„Ø§Ø¦Ù… (Ù…Ø«Ù„ Ø¯Ø±Ø¯ Ø¯Ù†Ø¯Ø§Ù†ØŒ Ø®ÙˆÙ†Ø±ÛŒØ²ÛŒ Ù„Ø«Ù‡) Ú¯ÙØªØŒ ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù‡ Ùˆ ØªÙˆØµÛŒÙ‡ Ø¨Ø¯Ù‡.
   - Ø¨Ù†ÙˆÛŒØ³: **Ø¨Ø±Ø§ÛŒ Ø¯Ø±Ù…Ø§Ù† Ø¯Ù†Ø¯Ø§Ù†ÛŒØŒ Ø­ØªÙ…Ø§Ù‹ Ø¨Ø§ ÛŒÙ‡ Ø¯Ù†Ø¯Ø§Ù†Ù¾Ø²Ø´Ú© Ù…Ø´ÙˆØ±Øª Ú©Ù†. ğŸ¦·**

2. **Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù¾Ø²Ø´Ú©ÛŒ**:
   - Ø§Ú¯Ø± Ù…Ø´Ú©Ù„ Ø´Ø¯ÛŒØ¯ (Ù…Ø«Ù„ Ø¢Ø¨Ø³Ù‡ ÛŒØ§ Ø¯Ø±Ø¯ Ø´Ø¯ÛŒØ¯) Ø¯ÛŒØ¯ÛŒØŒ Ù‡Ø´Ø¯Ø§Ø± Ø¨Ø¯Ù‡: **âš ï¸ Ù‡Ø´Ø¯Ø§Ø±: Ø§ÛŒÙ† Ù…Ù…Ú©Ù†Ù‡ Ø¬Ø¯ÛŒ Ø¨Ø§Ø´Ù‡! ÙÙˆØ±Ø§Ù‹ Ø¨Ù‡ Ø¯Ù†Ø¯Ø§Ù†Ù¾Ø²Ø´Ú© Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†.**

3. **Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ú©Ø§Ø±Ø¨Ø±**:
   - Ø¨Ú¯Ùˆ: *ØªØµÙˆÛŒØ± Ø¯Ù†Ø¯Ø§Ù† Ø¨ÙØ±Ø³Øª ÛŒØ§ Ø¹Ù„Ø§Ø¦Ù… (Ù…Ø«Ù„ Ø¯Ø±Ø¯ØŒ Ø®ÙˆÙ†Ø±ÛŒØ²ÛŒ Ù„Ø«Ù‡) Ø±Ùˆ Ø¨Ú¯Ùˆ ØªØ§ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ú©Ù†Ù…! ğŸ¦·*

**Ù†Ú©Ø§Øª Ù…Ù‡Ù…**:
   - Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ø±Ùˆ Ø®Ù„Ø§ØµÙ‡ Ùˆ Ø­Ø¯Ø§Ú©Ø«Ø± Ø¯Ø± 300 ØªÙˆÚ©Ù† Ù†Ú¯Ù‡ Ø¯Ø§Ø±.
   - Ø§Ø² Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø· (Ù…Ø«Ù„ ğŸ¦·ØŒ ğŸ©º) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.
   - Ø§Ú¯Ø± ØªØµÙˆÛŒØ± ÛŒØ§ Ø³Ø¤Ø§Ù„ ØºÛŒØ±Ù…Ø±ØªØ¨Ø· Ø¨ÙˆØ¯ØŒ Ø¨Ú¯Ùˆ: *Ø§ÛŒÙ† Ø¨Ù‡ Ø¯Ù†Ø¯Ø§Ù† Ø±Ø¨Ø·ÛŒ Ù†Ø¯Ø§Ø±Ù‡! Ù„Ø·ÙØ§Ù‹ ØªØµÙˆÛŒØ± ÛŒØ§ Ø³Ø¤Ø§Ù„ Ù…Ø±ØªØ¨Ø· Ø¨ÙØ±Ø³Øª. ğŸ˜Š*
   - Ø§Ø±Ø³Ø§Ù„ Ù„ÛŒÙ†Ú© Ù…Ù…Ù†ÙˆØ¹ Ø§Ø³Øª.
"""
}

# Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¯Ø± Ø­Ø§Ù„Øª Ú†Øª Ùˆ Ù‚ÙÙ„ Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
AI_CHAT_USERS = set()
PROCESSING_LOCK = Lock()
PROCESSED_MESSAGES = set()

application = None

app = FastAPI()

@app.post("/webhook")
async def webhook(request: Request):
    """Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ÙˆØ¨â€ŒÙ‡ÙˆÚ©"""
    global application
    update = await request.json()
    update_obj = Update.de_json(update, application.bot)
    update_id = update_obj.update_id
    logger.info(f"Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø§ update_id: {update_id}")
    with PROCESSING_LOCK:
        if update_id in PROCESSED_MESSAGES:
            logger.warning(f"Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨Ø§ update_id: {update_id} - Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ú¯Ø±ÙØªÙ‡ Ø´Ø¯")
            return {"status": "ok"}
        PROCESSED_MESSAGES.add(update_id)
    asyncio.create_task(application.process_update(update_obj))
    return {"status": "ok"}

@app.get("/")
async def root(request: Request):
    """Ù†Ù‚Ø·Ù‡ ÙˆØ±ÙˆØ¯ Ù¾Ø§ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø±ÙˆØ± Ùˆ Ù¾ÛŒÙ†Ú¯ UptimeRobot"""
    user_agent = request.headers.get("User-Agent", "Unknown")
    uptime_robot_header = request.headers.get("X-UptimeRobot", None)
    
    if uptime_robot_header == "Ping":
        logger.info("Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾ÛŒÙ†Ú¯ Ø§Ø² UptimeRobot (Ù‡Ø¯Ø± Ø³ÙØ§Ø±Ø´ÛŒ)")
    elif "UptimeRobot" in user_agent:
        logger.info("Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾ÛŒÙ†Ú¯ Ø§Ø² UptimeRobot (User-Agent)")
    else:
        logger.info(f"Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ / Ø§Ø² User-Agent: {user_agent}")
    
    try:
        response = {"message": "Bot is running!"}
        return response
    except Exception as e:
        logger.error(f"Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾ÛŒÙ†Ú¯: {e}")
        raise

@app.head("/")
async def root_head():
    """Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ù…ØªØ¯ HEAD Ø¨Ø±Ø§ÛŒ Ù¾ÛŒÙ†Ú¯â€ŒÙ‡Ø§ÛŒ UptimeRobot"""
    return Response(status_code=200)

@app.get("/favicon.ico")
async def favicon():
    """Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ favicon.ico"""
    return Response(status_code=204)

def clean_text(text):
    """Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ù…ØªÙ† Ø§Ø² ØªØ¨Ù„ÛŒØºØ§ØªØŒ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ Ùˆ Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ ØºÛŒØ±Ø¶Ø±ÙˆØ±ÛŒ"""
    if not text:
        return ""
    # Ø­Ø°Ù Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ Ø¨Ø§ regex
    text = re.sub(r'https?://\S+|www\.\S+', '', text)
    # Ø­Ø°Ù Ù…ØªÙ† Ø¨Ø¹Ø¯ Ø§Ø² ---
    if '---' in text:
        text = text.split('---')[0].strip()
    # Ø­Ø°Ù Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ ØºÛŒØ±Ø¶Ø±ÙˆØ±ÛŒ
    text = text.replace("*", "").replace("`", "").replace("[", "").replace("]", "").replace("!", "!")
    # Ø­Ø°Ù ØªØ¨Ù„ÛŒØºØ§Øª Ø®Ø§Øµ
    ad_texts = [
        "Powered by Pollinations.AI free text APIs. Support our mission(https://pollinations.ai/redirect/kofi) to keep AI accessible for everyone.",
        "ØªÙˆØ³Ø· Pollinations.AI Ø¨Ù‡ ØµÙˆØ±Øª Ø±Ø§ÛŒÚ¯Ø§Ù† Ø§Ø±Ø§Ø¦Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø§Ø² Ù…Ø£Ù…ÙˆØ±ÛŒØª Ù…Ø§ Ø­Ù…Ø§ÛŒØª Ú©Ù†ÛŒØ¯(https://pollinations.ai/redirect/kofi) ØªØ§ AI Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ù‚Ø§Ø¨Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ø§Ø´Ø¯."
    ]
    for ad_text in ad_texts:
        text = text.replace(ad_text, "").strip()
    return text.strip()

async def check_channel_membership(bot, user_id):
    """Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ú©Ø§Ù†Ø§Ù„"""
    try:
        member = await bot.get_chat_member(chat_id=CHANNEL_ID, user_id=user_id)
        return member.status in ['member', 'administrator', 'creator']
    except TelegramError as e:
        logger.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª Ú©Ø§Ø±Ø¨Ø± {user_id} Ø¯Ø± Ú©Ø§Ù†Ø§Ù„ {CHANNEL_ID}: {e}")
        return False

# ØªØ¹Ø±ÛŒÙ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ Ø¨Ø§ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØºÛŒØ±Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ
MAIN_MENU_KEYBOARD = ReplyKeyboardMarkup([
    ["Ù…Ø´Ø§ÙˆØ±Ù‡ Ù¾Ø²Ø´Ú©ÛŒ ğŸ©º", "ØªØ´Ø®ÛŒØµ Ø¹Ù„Ø§Ø¦Ù… ğŸ§«"],
    ["Ø¨Ø±Ø±Ø³ÛŒ Ø¢Ø²Ù…Ø§ÛŒØ´ ğŸ§ª", "ØªØ­Ù„ÛŒÙ„ Ù†ÙˆØ§Ø± Ù‚Ù„Ø¨ ğŸ“ˆ"],
    ["ØªÙØ³ÛŒØ± Ø±Ø§Ø¯ÛŒÙˆÙ„ÙˆÚ˜ÛŒ ğŸ©»", "Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø¯Ø§Ø±ÙˆÙ‡Ø§ ğŸ’Š"],
    ["Ø³Ù„Ø§Ù…Øª Ø±ÙˆØ§Ù† Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ ğŸ§ ", "Ù…Ø±Ø§Ù‚Ø¨Øª Ø§Ø² Ø²Ø®Ù… ğŸ©¹"],
    ["Ø³Ù„Ø§Ù…Øª Ø¯Ù‡Ø§Ù† Ùˆ Ø¯Ù†Ø¯Ø§Ù† ğŸ¦·", "Ø±Ø§Ù‡Ù†Ù…Ø§ â“"]
], resize_keyboard=True, one_time_keyboard=False)

# ØªØ¹Ø±ÛŒÙ Ù…Ù†ÙˆÛŒ Ø²ÛŒØ± Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ú¯Ø´Øª
SUB_MENU_KEYBOARD = ReplyKeyboardMarkup([
    ["Ø¨Ø±Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ â¬…ï¸"]
], resize_keyboard=True, one_time_keyboard=False)

async def check_rate_limit(context: ContextTypes.DEFAULT_TYPE, user_id: int) -> bool:
    """Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ù†Ø±Ø® Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ (20 Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø± Ø¯Ù‚ÛŒÙ‚Ù‡)"""
    if "request_timestamps" not in context.user_data:
        context.user_data["request_timestamps"] = []
    
    current_time = time.time()
    # Ø­Ø°Ù Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ± Ø§Ø² ÛŒÚ© Ø¯Ù‚ÛŒÙ‚Ù‡
    context.user_data["request_timestamps"] = [
        ts for ts in context.user_data["request_timestamps"] if current_time - ts < 60
    ]
    
    # Ø¨Ø±Ø±Ø³ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
    if len(context.user_data["request_timestamps"]) >= 20:
        return False
    
    # Ø§ÙØ²ÙˆØ¯Ù† Ø²Ù…Ø§Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¬Ø¯ÛŒØ¯
    context.user_data["request_timestamps"].append(current_time)
    return True

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ Ø¨Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª Ø¯Ø± Ú©Ø§Ù†Ø§Ù„"""
    user_id = update.effective_user.id
    user_name = update.message.from_user.first_name

    if user_id in AI_CHAT_USERS:
        AI_CHAT_USERS.remove(user_id)
    context.user_data.clear()

    is_member = await check_channel_membership(context.bot, user_id)
    if not is_member:
        welcome_message = clean_text(
            f"Ø³Ù„Ø§Ù… {user_name}!\nØ¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¯Ø³ØªÛŒØ§Ø± Ù¾Ø²Ø´Ú©ÛŒØŒ Ø¨Ø§ÛŒØ¯ ØªÙˆ Ú©Ø§Ù†Ø§Ù„ Ø¹Ø¶Ùˆ Ø¨Ø´ÛŒ! ğŸ¥\n"
            "Ù„Ø·ÙØ§Ù‹ ØªÙˆ Ú©Ø§Ù†Ø§Ù„ Ø¹Ø¶Ùˆ Ø´Ùˆ Ùˆ Ø¨Ø¹Ø¯ Ø¯Ú©Ù…Ù‡ *Ø¹Ø¶Ùˆ Ø´Ø¯Ù…* Ø±Ùˆ Ø¨Ø²Ù†! ğŸš‘"
        )
        keyboard = [
            [InlineKeyboardButton("Ø¹Ø¶Ùˆ Ú©Ø§Ù†Ø§Ù„ Ø´Ùˆ ğŸ“¢", url=CHANNEL_LINK)],
            [InlineKeyboardButton("Ø¹Ø¶Ùˆ Ø´Ø¯Ù…! âœ…", callback_data="check_membership")]
        ]
        await update.message.reply_text(
            welcome_message,
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode="Markdown"
        )
        return

    welcome_message = clean_text(
        f"Ø³Ù„Ø§Ù… {user_name}!\nØ¨Ù‡ *Ø¯Ø³ØªÛŒØ§Ø± Ù¾Ø²Ø´Ú©ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯* Ø®ÙˆØ´ Ø§ÙˆÙ…Ø¯ÛŒ! ğŸ©º\n"
        "ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†:"
    )
    await update.message.reply_text(
        welcome_message,
        reply_markup=MAIN_MENU_KEYBOARD,
        parse_mode="Markdown"
    )

async def check_membership(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª Ú©Ø§Ø±Ø¨Ø± Ù¾Ø³ Ø§Ø² Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ 'Ø¹Ø¶Ùˆ Ø´Ø¯Ù…'"""
    query = update.callback_query
    await query.answer()
    user_id = query.from_user.id
    user_name = query.from_user.first_name

    is_member = await check_channel_membership(context.bot, user_id)
    if not is_member:
        await query.edit_message_text(
            clean_text(
                f"Ø§ÙˆÙ¾Ø³! ğŸ˜… Ù‡Ù†ÙˆØ² ØªÙˆ Ú©Ø§Ù†Ø§Ù„ Ø¹Ø¶Ùˆ Ù†Ø´Ø¯ÛŒ!\n"
                "Ù„Ø·ÙØ§Ù‹ ØªÙˆ Ú©Ø§Ù†Ø§Ù„ Ø¹Ø¶Ùˆ Ø´Ùˆ Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¯Ú©Ù…Ù‡ *Ø¹Ø¶Ùˆ Ø´Ø¯Ù…* Ø±Ùˆ Ø¨Ø²Ù†! ğŸš‘"
            ),
            reply_markup=InlineKeyboardMarkup([
                [InlineKeyboardButton("Ø¹Ø¶Ùˆ Ú©Ø§Ù†Ø§Ù„ Ø´Ùˆ ğŸ“¢", url=CHANNEL_LINK)],
                [InlineKeyboardButton("Ø¹Ø¶Ùˆ Ø´Ø¯Ù…! âœ…", callback_data="check_membership")]
            ]),
            parse_mode="Markdown"
        )
        return

    welcome_message = clean_text(
        f"Ø¢ÙØ±ÛŒÙ† {user_name}! Ø­Ø§Ù„Ø§ Ú©Ù‡ ØªÙˆ Ú©Ø§Ù†Ø§Ù„ Ø¹Ø¶ÙˆÛŒØŒ *Ø¯Ø³ØªÛŒØ§Ø± Ù¾Ø²Ø´Ú©ÛŒ* Ø¨Ø±Ø§Øª ÙØ¹Ø§Ù„ Ø´Ø¯! ğŸ©º\n"
        "ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†:"
    )
    await query.edit_message_text(
        welcome_message,
        reply_markup=MAIN_MENU_KEYBOARD,
        parse_mode="Markdown"
    )

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ù…ØªÙ†ÛŒ Ú©Ø§Ø±Ø¨Ø±"""
    user_id = update.effective_user.id
    message_text = update.message.text
    chat_id = update.message.chat_id

    # Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª Ø¯Ø± Ú©Ø§Ù†Ø§Ù„
    is_member = await check_channel_membership(context.bot, user_id)
    if not is_member:
        welcome_message = clean_text(
            "Ø§ÙˆÙ¾Ø³! ğŸ˜… Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª Ø¨Ø§ÛŒØ¯ ØªÙˆ Ú©Ø§Ù†Ø§Ù„ Ø¹Ø¶Ùˆ Ø¨Ø´ÛŒ!\n"
            "Ù„Ø·ÙØ§Ù‹ ØªÙˆ Ú©Ø§Ù†Ø§Ù„ Ø¹Ø¶Ùˆ Ø´Ùˆ Ùˆ Ø¨Ø¹Ø¯ Ø¯Ú©Ù…Ù‡ *Ø¹Ø¶Ùˆ Ø´Ø¯Ù…* Ø±Ùˆ Ø¨Ø²Ù†! ğŸš‘"
        )
        keyboard = [
            [InlineKeyboardButton("Ø¹Ø¶Ùˆ Ú©Ø§Ù†Ø§Ù„ Ø´Ùˆ ğŸ“¢", url=CHANNEL_LINK)],
            [InlineKeyboardButton("Ø¹Ø¶Ùˆ Ø´Ø¯Ù…! âœ…", callback_data="check_membership")]
        ]
        await update.message.reply_text(
            welcome_message,
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode="Markdown"
        )
        return

    # Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ù†Ø±Ø® Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
    if not await check_rate_limit(context, user_id):
        await update.message.reply_text(
            clean_text("Ù„Ø·ÙØ§Ù‹ Ú†Ù†Ø¯ Ù„Ø­Ø¸Ù‡ ØµØ¨Ø± Ú©Ù†! ğŸ˜Š ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§Øª Ø²ÛŒØ§Ø¯ Ø´Ø¯Ù‡."),
            reply_markup=MAIN_MENU_KEYBOARD,
            parse_mode="Markdown"
        )
        return

    # Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ
    if message_text == "Ù…Ø´Ø§ÙˆØ±Ù‡ Ù¾Ø²Ø´Ú©ÛŒ ğŸ©º":
        AI_CHAT_USERS.add(user_id)
        context.user_data.clear()
        context.user_data["mode"] = "ai_chat"
        context.user_data["chat_history"] = []
        await update.message.reply_text(
            clean_text(
                "ğŸ¤– *Ø¯Ø³ØªÛŒØ§Ø± Ù¾Ø²Ø´Ú©ÛŒ* ÙØ¹Ø§Ù„ Ø´Ø¯!\n\n"
                "Ø³Ø¤Ø§Ù„Øª Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø¨ÛŒÙ…Ø§Ø±ÛŒ ÛŒØ§ Ù…ÙˆØ¶ÙˆØ¹ Ù¾Ø²Ø´Ú©ÛŒ Ú†ÛŒÙ‡ØŸ\n"
                "Ù…Ø«Ù„Ø§Ù‹ Ø¨Ù¾Ø±Ø³: *Ø³Ø±Ù…Ø§Ø®ÙˆØ±Ø¯Ú¯ÛŒ Ú†ÛŒ Ø¨Ø®ÙˆØ±Ù…ØŸ* ÛŒØ§ *Ø³Ø±Ø¯Ø±Ø¯ Ø¯Ø§Ø±Ù… Ú†ÛŒÚ©Ø§Ø± Ú©Ù†Ù…ØŸ* ğŸ˜Š"
            ),
            reply_markup=SUB_MENU_KEYBOARD,
            parse_mode="Markdown"
        )
    elif message_text == "Ø¨Ø±Ø±Ø³ÛŒ Ø¢Ø²Ù…Ø§ÛŒØ´ ğŸ§ª":
        AI_CHAT_USERS.add(user_id)
        context.user_data.clear()
        context.user_data["mode"] = "lab_test"
        context.user_data["chat_history"] = []
        await update.message.reply_text(
            clean_text(
                "ğŸ§ª *Ø¨Ø±Ø±Ø³ÛŒ Ø¢Ø²Ù…Ø§ÛŒØ´* ÙØ¹Ø§Ù„ Ø´Ø¯!\n\n"
                "ØªØµÙˆÛŒØ± Ø¨Ø±Ú¯Ù‡ Ø¢Ø²Ù…Ø§ÛŒØ´ Ø¨ÙØ±Ø³Øª ÛŒØ§ Ø³Ø¤Ø§Ù„Øª Ø±Ùˆ Ø¨Ú¯Ùˆ!\n"
                "Ù…Ø«Ù„Ø§Ù‹: *Ù‚Ù†Ø¯ Ø®ÙˆÙ† 150 ÛŒØ¹Ù†ÛŒ Ú†ÛŒØŸ* ğŸ˜Š"
            ),
            reply_markup=SUB_MENU_KEYBOARD,
            parse_mode="Markdown"
        )
    elif message_text == "ØªØ­Ù„ÛŒÙ„ Ù†ÙˆØ§Ø± Ù‚Ù„Ø¨ ğŸ“ˆ":
        AI_CHAT_USERS.add(user_id)
        context.user_data.clear()
        context.user_data["mode"] = "ecg"
        context.user_data["chat_history"] = []
        await update.message.reply_text(
            clean_text(
                "ğŸ“ˆ *ØªØ­Ù„ÛŒÙ„ Ù†ÙˆØ§Ø± Ù‚Ù„Ø¨* ÙØ¹Ø§Ù„ Ø´Ø¯!\n\n"
                "ØªØµÙˆÛŒØ± Ù†ÙˆØ§Ø± Ù‚Ù„Ø¨ Ø¨ÙØ±Ø³Øª ÛŒØ§ Ø³Ø¤Ø§Ù„Øª Ø±Ùˆ Ø¨Ú¯Ùˆ!\n"
                "Ù…Ø«Ù„Ø§Ù‹: *Ø±ÛŒØªÙ… Ù†Ø§Ù…Ù†Ø¸Ù… ÛŒØ¹Ù†ÛŒ Ú†ÛŒØŸ* ğŸ˜Š"
            ),
            reply_markup=SUB_MENU_KEYBOARD,
            parse_mode="Markdown"
        )
    elif message_text == "ØªÙØ³ÛŒØ± Ø±Ø§Ø¯ÛŒÙˆÙ„ÙˆÚ˜ÛŒ ğŸ©»":
        AI_CHAT_USERS.add(user_id)
        context.user_data.clear()
        context.user_data["mode"] = "radiology"
        context.user_data["chat_history"] = []
        await update.message.reply_text(
            clean_text(
                "ğŸ©» *ØªÙØ³ÛŒØ± Ø±Ø§Ø¯ÛŒÙˆÙ„ÙˆÚ˜ÛŒ* ÙØ¹Ø§Ù„ Ø´Ø¯!\n\n"
                "ØªØµÙˆÛŒØ± Ø±Ø§Ø¯ÛŒÙˆÙ„ÙˆÚ˜ÛŒ (Ù…Ø«Ù„ X-ray ÛŒØ§ CT) Ø¨ÙØ±Ø³Øª ÛŒØ§ Ø³Ø¤Ø§Ù„Øª Ø±Ùˆ Ø¨Ú¯Ùˆ!\n"
                "Ù…Ø«Ù„Ø§Ù‹: *Ø§ÛŒÙ† Ø³Ø§ÛŒÙ‡ ØªÙˆ X-ray Ú†ÛŒÙ‡ØŸ* ğŸ˜Š"
            ),
            reply_markup=SUB_MENU_KEYBOARD,
            parse_mode="Markdown"
        )
    elif message_text == "ØªØ´Ø®ÛŒØµ Ø¹Ù„Ø§Ø¦Ù… ğŸ§«":
        AI_CHAT_USERS.add(user_id)
        context.user_data.clear()
        context.user_data["mode"] = "symptom_diagnosis"
        context.user_data["chat_history"] = []
        await update.message.reply_text(
            clean_text(
                "ğŸ§« *ØªØ´Ø®ÛŒØµ Ø¹Ù„Ø§Ø¦Ù…* ÙØ¹Ø§Ù„ Ø´Ø¯!\n\n"
                "Ø¹Ù„Ø§Ø¦Ù…Øª Ø±Ùˆ Ú©Ø§Ù…Ù„ Ø¨Ú¯Ùˆ (Ù…Ø«Ù„ ØªØ¨ØŒ Ø³Ø±ÙÙ‡ØŒ Ù…Ø¯Øª Ø²Ù…Ø§Ù†)!\n"
                "Ù…Ø«Ù„Ø§Ù‹: *Ø¯Ùˆ Ø±ÙˆØ²Ù‡ ØªØ¨ Ø¯Ø§Ø±Ù… Ùˆ Ø³Ø±ÙÙ‡ Ù…ÛŒâ€ŒÚ©Ù†Ù…ØŒ Ú†ÛŒÙ‡ØŸ* ğŸ˜Š"
            ),
            reply_markup=SUB_MENU_KEYBOARD,
            parse_mode="Markdown"
        )
    elif message_text == "Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø¯Ø§Ø±ÙˆÙ‡Ø§ ğŸ’Š":
        AI_CHAT_USERS.add(user_id)
        context.user_data.clear()
        context.user_data["mode"] = "drug_identification"
        context.user_data["chat_history"] = []
        await update.message.reply_text(
            clean_text(
                "ğŸ’Š *Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø¯Ø§Ø±ÙˆÙ‡Ø§* ÙØ¹Ø§Ù„ Ø´Ø¯!\n\n"
                "ØªØµÙˆÛŒØ± Ù‚Ø±Øµ ÛŒØ§ Ø¬Ø¹Ø¨Ù‡ Ø¨ÙØ±Ø³ØªØŒ ÛŒØ§ Ø³Ø¤Ø§Ù„Øª Ø±Ùˆ Ø¨Ú¯Ùˆ!\n"
                "Ù…Ø«Ù„Ø§Ù‹: *Ø¹ÙˆØ§Ø±Ø¶ Ø¢Ø³Ù¾Ø±ÛŒÙ† Ú†ÛŒÙ‡ØŸ* ÛŒØ§ *Ø¯ÙˆØ² Ø¢Ù…ÙˆÚ©Ø³ÛŒâ€ŒØ³ÛŒÙ„ÛŒÙ† Ú†Ù‚Ø¯Ø±Ù‡ØŸ* ğŸ˜Š"
            ),
            reply_markup=SUB_MENU_KEYBOARD,
            parse_mode="Markdown"
        )
    elif message_text == "Ø³Ù„Ø§Ù…Øª Ø±ÙˆØ§Ù† Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ ğŸ§ ":
        AI_CHAT_USERS.add(user_id)
        context.user_data.clear()
        context.user_data["mode"] = "mental_health"
        context.user_data["chat_history"] = []
        await update.message.reply_text(
            clean_text(
                "ğŸ§  *Ø³Ù„Ø§Ù…Øª Ø±ÙˆØ§Ù† Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ* ÙØ¹Ø§Ù„ Ø´Ø¯!\n\n"
                "Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø­Ø§Ù„Øª Ø¨Ú¯Ùˆ (Ù…Ø«Ù„ Ø§Ø³ØªØ±Ø³ØŒ Ø¨ÛŒâ€ŒØ®ÙˆØ§Ø¨ÛŒ) ÛŒØ§ Ø¨Ù‡ Ú†Ù†Ø¯ Ø³Ø¤Ø§Ù„Ù… Ø¬ÙˆØ§Ø¨ Ø¨Ø¯Ù‡!\n"
                "Ù…Ø«Ù„Ø§Ù‹: *Ø§Ø®ÛŒØ±Ø§Ù‹ Ø§Ø³ØªØ±Ø³ Ø¯Ø§Ø±Ù…ØŒ Ú†ÛŒÚ©Ø§Ø± Ú©Ù†Ù…ØŸ* ğŸ˜Š"
            ),
            reply_markup=SUB_MENU_KEYBOARD,
            parse_mode="Markdown"
        )
    elif message_text == "Ù…Ø±Ø§Ù‚Ø¨Øª Ø§Ø² Ø²Ø®Ù… ğŸ©¹":
        AI_CHAT_USERS.add(user_id)
        context.user_data.clear()
        context.user_data["mode"] = "wound_care"
        context.user_data["chat_history"] = []
        await update.message.reply_text(
            clean_text(
                "ğŸ©¹ *Ù…Ø±Ø§Ù‚Ø¨Øª Ø§Ø² Ø²Ø®Ù…* ÙØ¹Ø§Ù„ Ø´Ø¯!\n\n"
                "ØªØµÙˆÛŒØ± Ø²Ø®Ù… Ø¨ÙØ±Ø³Øª ÛŒØ§ Ø¹Ù„Ø§Ø¦Ù… (Ù…Ø«Ù„ Ù‚Ø±Ù…Ø²ÛŒØŒ Ø¯Ø±Ø¯) Ø±Ùˆ Ø¨Ú¯Ùˆ!\n"
                "Ù…Ø«Ù„Ø§Ù‹: *Ø²Ø®Ù…Ù… Ù‚Ø±Ù…Ø² Ø´Ø¯Ù‡ØŒ Ú†ÛŒÚ©Ø§Ø± Ú©Ù†Ù…ØŸ* ğŸ˜Š"
            ),
            reply_markup=SUB_MENU_KEYBOARD,
            parse_mode="Markdown"
        )
    elif message_text == "Ø³Ù„Ø§Ù…Øª Ø¯Ù‡Ø§Ù† Ùˆ Ø¯Ù†Ø¯Ø§Ù† ğŸ¦·":
        AI_CHAT_USERS.add(user_id)
        context.user_data.clear()
        context.user_data["mode"] = "dental_health"
        context.user_data["chat_history"] = []
        await update.message.reply_text(
            clean_text(
                "ğŸ¦· *Ø³Ù„Ø§Ù…Øª Ø¯Ù‡Ø§Ù† Ùˆ Ø¯Ù†Ø¯Ø§Ù†* ÙØ¹Ø§Ù„ Ø´Ø¯!\n\n"
                "ØªØµÙˆÛŒØ± Ø¯Ù†Ø¯Ø§Ù† Ø¨ÙØ±Ø³Øª ÛŒØ§ Ø¹Ù„Ø§Ø¦Ù… (Ù…Ø«Ù„ Ø¯Ø±Ø¯ØŒ Ø®ÙˆÙ†Ø±ÛŒØ²ÛŒ Ù„Ø«Ù‡) Ø±Ùˆ Ø¨Ú¯Ùˆ!\n"
                "Ù…Ø«Ù„Ø§Ù‹: *Ø¯Ù†Ø¯ÙˆÙ†Ù… Ø¯Ø±Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ù‡ØŒ Ú†ÛŒÚ©Ø§Ø± Ú©Ù†Ù…ØŸ* ğŸ˜Š"
            ),
            reply_markup=SUB_MENU_KEYBOARD,
            parse_mode="Markdown"
        )
    elif message_text == "Ø±Ø§Ù‡Ù†Ù…Ø§ â“":
        guide_message = clean_text(
            "ğŸ“– *Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¯Ø³ØªÛŒØ§Ø± Ù¾Ø²Ø´Ú©ÛŒ*:\n\n"
            "- **Ù…Ø´Ø§ÙˆØ±Ù‡ Ù¾Ø²Ø´Ú©ÛŒ ğŸ©º**: Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§ ÛŒØ§ Ø¹Ù„Ø§Ø¦Ù… Ø³Ø¤Ø§Ù„ Ú©Ù†.\n"
            "- **ØªØ´Ø®ÛŒØµ Ø¹Ù„Ø§Ø¦Ù… ğŸ§«**: Ø¹Ù„Ø§Ø¦Ù…Øª Ø±Ùˆ Ø¨Ú¯Ùˆ ØªØ§ ØªØ´Ø®ÛŒØµ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ Ø¨Ø¯Ù….\n"
            "- **Ø¨Ø±Ø±Ø³ÛŒ Ø¢Ø²Ù…Ø§ÛŒØ´ ğŸ§ª**: Ø¨Ø±Ú¯Ù‡ Ø¢Ø²Ù…Ø§ÛŒØ´ Ø¨ÙØ±Ø³Øª ÛŒØ§ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù†ØªØ§ÛŒØ¬ Ø¨Ù¾Ø±Ø³.\n"
            "- **ØªØ­Ù„ÛŒÙ„ Ù†ÙˆØ§Ø± Ù‚Ù„Ø¨ ğŸ“ˆ**: ØªØµÙˆÛŒØ± Ù†ÙˆØ§Ø± Ù‚Ù„Ø¨ Ø¨ÙØ±Ø³Øª.\n"
            "- **ØªÙØ³ÛŒØ± Ø±Ø§Ø¯ÛŒÙˆÙ„ÙˆÚ˜ÛŒ ğŸ©»**: ØªØµÙˆÛŒØ± X-ray ÛŒØ§ CT Ø¨ÙØ±Ø³Øª.\n"
            "- **Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø¯Ø§Ø±ÙˆÙ‡Ø§ ğŸ’Š**: ØªØµÙˆÛŒØ± Ù‚Ø±Øµ ÛŒØ§ Ø³Ø¤Ø§Ù„ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø¯Ø§Ø±Ùˆ Ø¨ÙØ±Ø³Øª.\n"
            "- **Ø³Ù„Ø§Ù…Øª Ø±ÙˆØ§Ù† Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ ğŸ§ **: Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø§Ø³ØªØ±Ø³ ÛŒØ§ Ø­Ø§Ù„Øª Ø±ÙˆØ­ÛŒ Ø¨Ú¯Ùˆ.\n"
            "- **Ù…Ø±Ø§Ù‚Ø¨Øª Ø§Ø² Ø²Ø®Ù… ğŸ©¹**: ØªØµÙˆÛŒØ± Ø²Ø®Ù… Ø¨ÙØ±Ø³Øª ÛŒØ§ Ø¹Ù„Ø§Ø¦Ù… Ø±Ùˆ Ø¨Ú¯Ùˆ.\n"
            "- **Ø³Ù„Ø§Ù…Øª Ø¯Ù‡Ø§Ù† Ùˆ Ø¯Ù†Ø¯Ø§Ù† ğŸ¦·**: ØªØµÙˆÛŒØ± Ø¯Ù†Ø¯Ø§Ù† ÛŒØ§ Ø¹Ù„Ø§Ø¦Ù… Ø¯Ù†Ø¯Ø§Ù†ÛŒ Ø¨ÙØ±Ø³Øª.\n\n"
            "*Ù‡Ù…ÛŒØ´Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ ÛŒØ§ Ø¯Ø±Ù…Ø§Ù† Ø¨Ø§ Ù¾Ø²Ø´Ú© Ù…Ø´ÙˆØ±Øª Ú©Ù†!* ğŸ©º\n"
            "Ø³Ø¤Ø§Ù„ÛŒ Ø¯Ø§Ø±ÛŒØŸ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†! ğŸ˜Š"
        )
        await update.message.reply_text(
            guide_message,
            reply_markup=MAIN_MENU_KEYBOARD,
            parse_mode="Markdown"
        )
    elif message_text == "Ø¨Ø±Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ â¬…ï¸":
        if user_id in AI_CHAT_USERS:
            AI_CHAT_USERS.remove(user_id)
        context.user_data.clear()
        await update.message.reply_text(
            clean_text("Ø¨Ù‡ *Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ* Ø¨Ø±Ú¯Ø´ØªÛŒ! ğŸ˜Š ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†:"),
            reply_markup=MAIN_MENU_KEYBOARD,
            parse_mode="Markdown"
        )
    elif user_id in AI_CHAT_USERS and context.user_data.get("mode") in SYSTEM_MESSAGES.keys():
        message_id = update.message.message_id
        with PROCESSING_LOCK:
            if message_id in PROCESSED_MESSAGES:
                logger.warning(f"Ù¾ÛŒØ§Ù… ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨Ø§ message_id: {message_id} - Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ú¯Ø±ÙØªÙ‡ Ø´Ø¯")
                return
            PROCESSED_MESSAGES.add(message_id)

        user_message = update.message.text
        chat_history = context.user_data.get("chat_history", [])
        chat_history.append({"role": "user", "content": user_message})
        context.user_data["chat_history"] = chat_history

        # Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ø±Ø§Ù…Ù¾ Ø³ÛŒØ³ØªÙ…ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ mode
        system_message = SYSTEM_MESSAGES.get(context.user_data["mode"], SYSTEM_MESSAGES["ai_chat"])

        # Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ù…ÙˆÙ‚Øª
        temp_message = await update.message.reply_text(clean_text("ğŸ©º *Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...*"), parse_mode="Markdown")

        payload = {
            "model": "openai-large",
            "messages": [
                {"role": "system", "content": system_message}
            ] + chat_history,
            "max_tokens": 300,
            "seed": 42,
            "json_mode": False
        }

        # Ù…Ú©Ø§Ù†ÛŒØ²Ù… retry Ø¨Ø±Ø§ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª API
        for attempt in range(2):
            try:
                response = requests.post(TEXT_API_URL, json=payload, timeout=20)
                try:
                    await context.bot.delete_message(chat_id=chat_id, message_id=temp_message.message_id)
                except TelegramError as e:
                    logger.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù… Ù…ÙˆÙ‚Øª: {e}")

                if response.status_code == 200:
                    response_data = response.json()
                    ai_response = response_data.get("choices", [{}])[0].get("message", {}).get("content", "Ù¾Ø§Ø³Ø®ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯!")
                    ai_response = clean_text(ai_response.strip())
                    chat_history.append({"role": "assistant", "content": ai_response})
                    context.user_data["chat_history"] = chat_history
                    await update.message.reply_text(
                        ai_response,
                        reply_markup=SUB_MENU_KEYBOARD,
                        parse_mode="Markdown"
                    )
                    break
                else:
                    await update.message.reply_text(
                        clean_text("Ø§ÙˆÙ¾Ø³ØŒ *Ø³ÛŒØ³ØªÙ… Ù¾Ø²Ø´Ú©ÛŒâ€ŒÙ…ÙˆÙ†* ÛŒÙ‡ Ù„Ø­Ø¸Ù‡ Ù‚ÙÙ„ Ú©Ø±Ø¯! ğŸ©º Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø³Ø¤Ø§Ù„Øª Ø±Ùˆ Ø¨ÙØ±Ø³Øª. ğŸ˜Š"),
                        reply_markup=SUB_MENU_KEYBOARD,
                        parse_mode="Markdown"
                    )
                    break
            except requests.exceptions.RequestException as e:
                logger.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ API Ú†Øª (ØªÙ„Ø§Ø´ {attempt + 1}): {e}")
                if attempt == 1:
                    try:
                        await context.bot.delete_message(chat_id=chat_id, message_id=temp_message.message_id)
                    except TelegramError as e:
                        logger.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù… Ù…ÙˆÙ‚Øª: {e}")
                    await update.message.reply_text(
                        clean_text("Ø§ÙˆÙ‡ØŒ *Ø§Ø¨Ø²Ø§Ø± ØªØ´Ø®ÛŒØµâ€ŒÙ…ÙˆÙ†* Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø§Ø±Ù‡! ğŸ’‰ Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø³Ø¤Ø§Ù„Øª Ø±Ùˆ Ø¨ÙØ±Ø³Øª. ğŸ˜Š"),
                        reply_markup=SUB_MENU_KEYBOARD,
                        parse_mode="Markdown"
                    )
    else:
        await update.message.reply_text(
            clean_text("Ù„Ø·ÙØ§Ù‹ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ *Ù…Ù†Ùˆ* Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†! ğŸ˜Š"),
            reply_markup=MAIN_MENU_KEYBOARD,
            parse_mode="Markdown"
        )

async def handle_photo(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ù…Ø¯ÛŒØ±ÛŒØª Ø¹Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ Ùˆ ØªØ­Ù„ÛŒÙ„ Ø¨Ø§ API Pollinations"""
    user_id = update.effective_user.id
    valid_modes = ["lab_test", "ecg", "radiology", "drug_identification", "wound_care", "dental_health"]
    if user_id not in AI_CHAT_USERS or context.user_data.get("mode") not in valid_modes:
        await update.message.reply_text(
            clean_text("Ù„Ø·ÙØ§Ù‹ Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ ØªØµÙˆÛŒØ±ØŒ Ú¯Ø²ÛŒÙ†Ù‡ Ù…Ø±ØªØ¨Ø· Ø±Ùˆ Ø§Ø² *Ù…Ù†Ùˆ* Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†! ğŸ˜Š"),
            reply_markup=MAIN_MENU_KEYBOARD,
            parse_mode="Markdown"
        )
        return

    # Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ù†Ø±Ø® Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
    if not await check_rate_limit(context, user_id):
        await update.message.reply_text(
            clean_text("Ù„Ø·ÙØ§Ù‹ Ú†Ù†Ø¯ Ù„Ø­Ø¸Ù‡ ØµØ¨Ø± Ú©Ù†! ğŸ˜Š ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§Øª Ø²ÛŒØ§Ø¯ Ø´Ø¯Ù‡."),
            reply_markup=MAIN_MENU_KEYBOARD,
            parse_mode="Markdown"
        )
        return

    message_id = update.message.message_id
    with PROCESSING_LOCK:
        if message_id in PROCESSED_MESSAGES:
            logger.warning(f"Ù¾ÛŒØ§Ù… ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨Ø§ message_id: {message_id} - Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ú¯Ø±ÙØªÙ‡ Ø´Ø¯")
            return
        PROCESSED_MESSAGES.add(message_id)

    chat_id = update.message.chat_id
    temp_message = await update.message.reply_text(clean_text("ğŸ”¬ *Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„ ØªØµÙˆÛŒØ±...*"), parse_mode="Markdown")

    photo = update.message.photo[-1]
    file = await context.bot.get_file(photo.file_id)
    file_url = file.file_path

    caption = update.message.caption if update.message.caption else "Ø§ÛŒÙ† ØªØµÙˆÛŒØ± Ú†ÛŒÙ‡ØŸ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø®Ù„Ø§ØµÙ‡ Ùˆ Ø¯Ù‚ÛŒÙ‚ ØªØ­Ù„ÛŒÙ„ Ú©Ù†! ğŸ©º"
    mode = context.user_data.get("mode")

    chat_history = context.user_data.get("chat_history", [])
    image_message = {
        "role": "user",
        "content": [
            {"type": "text", "text": caption},
            {"type": "image_url", "image_url": {"url": file_url}}
        ]
    }
    chat_history.append(image_message)
    context.user_data["chat_history"] = chat_history

    # Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ø±Ø§Ù…Ù¾ Ø³ÛŒØ³ØªÙ…ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ mode
    system_message = SYSTEM_MESSAGES[mode]

    payload = {
        "model": "openai-large",
        "messages": [
            {"role": "system", "content": system_message}
        ] + chat_history,
        "max_tokens": 300,
        "seed": 42,
        "json_mode": False
    }

    # Ù…Ú©Ø§Ù†ÛŒØ²Ù… retry Ø¨Ø±Ø§ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª API
    for attempt in range(2):
        try:
            response = requests.post(TEXT_API_URL, json=payload, timeout=20)
            try:
                await context.bot.delete_message(chat_id=chat_id, message_id=temp_message.message_id)
            except TelegramError as e:
                logger.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù… Ù…ÙˆÙ‚Øª: {e}")

            if response.status_code == 200:
                response_data = response.json()
                ai_response = response_data.get("choices", [{}])[0].get("message", {}).get("content", "Ù¾Ø§Ø³Ø®ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯!")
                ai_response = clean_text(ai_response.strip())
                chat_history.append({"role": "assistant", "content": ai_response})
                context.user_data["chat_history"] = chat_history
                await update.message.reply_text(
                    ai_response,
                    reply_markup=SUB_MENU_KEYBOARD,
                    parse_mode="Markdown"
                )
                break
            else:
                await update.message.reply_text(
                    clean_text("Ø§ÙˆÙ‡ØŒ *Ø¯Ø³ØªÚ¯Ø§Ù‡ ØªØ­Ù„ÛŒÙ„â€ŒÙ…ÙˆÙ†* Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ… Ø¯Ø§Ø±Ù‡! ğŸ’‰ Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¹Ú©Ø³ Ø±Ùˆ Ø¨ÙØ±Ø³Øª. ğŸ©»"),
                    reply_markup=SUB_MENU_KEYBOARD,
                    parse_mode="Markdown"
                )
                break
        except requests.exceptions.RequestException as e:
            logger.error(f"Ø®Ø·Ø§ Ø¯Ø± ØªØ­Ù„ÛŒÙ„ ØªØµÙˆÛŒØ± (ØªÙ„Ø§Ø´ {attempt + 1}): {e}")
            if attempt == 1:
                try:
                    await context.bot.delete_message(chat_id=chat_id, message_id=temp_message.message_id)
                except TelegramError as e:
                    logger.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù… Ù…ÙˆÙ‚Øª: {e}")
                await update.message.reply_text(
                    clean_text("Ø§ÙˆÙ¾Ø³ØŒ *Ø§Ø³Ú©Ù†Ø± Ù¾Ø²Ø´Ú©ÛŒâ€ŒÙ…ÙˆÙ†* ÛŒÙ‡ Ù„Ø­Ø¸Ù‡ Ø®Ø§Ù…ÙˆØ´ Ø´Ø¯! ğŸ©º Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¹Ú©Ø³ Ø±Ùˆ Ø¨ÙØ±Ø³Øª. ğŸ˜Š"),
                    reply_markup=SUB_MENU_KEYBOARD,
                    parse_mode="Markdown"
                )

async def error_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§Ù‡Ø§"""
    logger.error(f"Ø®Ø·Ø§ Ø±Ø® Ø¯Ø§Ø¯: {context.error}")
    error_message = "Ø§ÙˆÙ¾Ø³ØŒ *Ø³ÛŒØ³ØªÙ… Ú©Ù„ÛŒÙ†ÛŒÚ©ÛŒâ€ŒÙ…ÙˆÙ†* ÛŒÙ‡ Ù„Ø­Ø¸Ù‡ Ù‚Ø·Ø¹ Ø´Ø¯! ğŸ©» Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†. ğŸ˜Š"
    
    if isinstance(context.error, NetworkError):
        error_message = "Ù…Ø´Ú©Ù„ *Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø´Ø¨Ú©Ù‡* Ø¯Ø§Ø±ÛŒÙ…! ğŸ›œ Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†. ğŸ˜Š"
    elif isinstance(context.error, TimedOut):
        error_message = "Ø¯Ø±Ø®ÙˆØ§Ø³Øª *Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ø·ÙˆÙ„ Ú©Ø´ÛŒØ¯*! â³ Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†. ğŸ˜Š"
    
    if update and hasattr(update, 'message') and update.message:
        await update.message.reply_text(
            clean_text(error_message),
            reply_markup=MAIN_MENU_KEYBOARD,
            parse_mode="Markdown"
        )
    elif update and hasattr(update, 'callback_query') and update.callback_query:
        await update.callback_query.message.reply_text(
            clean_text(error_message),
            reply_markup=MAIN_MENU_KEYBOARD,
            parse_mode="Markdown"
        )

async def main():
    """Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø±Ø¨Ø§Øª Ø¨Ø§ ÙˆØ¨â€ŒÙ‡ÙˆÚ© Ùˆ Ø³Ø±ÙˆØ± FastAPI"""
    global application
    try:
        application = Application.builder().token(TOKEN).read_timeout(60).write_timeout(60).connect_timeout(60).build()
        await application.bot.set_webhook(url=WEBHOOK_URL)
        logger.info(f"Webhook Ø±ÙˆÛŒ {WEBHOOK_URL} ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯.")

        application.add_handler(CommandHandler("start", start, filters=filters.ChatType.PRIVATE))
        application.add_handler(CallbackQueryHandler(check_membership, pattern="^check_membership$"))
        application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND & filters.ChatType.PRIVATE, handle_message))
        application.add_handler(MessageHandler(filters.PHOTO & filters.ChatType.PRIVATE, handle_photo))
        application.add_error_handler(error_handler)

        logger.info("Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø±Ø¨Ø§Øª...")
        await application.initialize()
        logger.info("Ø¯Ø± Ø­Ø§Ù„ Ø´Ø±ÙˆØ¹ Ø±Ø¨Ø§Øª...")
        await application.start()

        config = uvicorn.Config(app, host="0.0.0.0", port=8000)
        server = uvicorn.Server(config)
        await server.serve()

    except Exception as e:
        logger.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø±Ø¨Ø§Øª: {e}")
        raise

if __name__ == "__main__":
    asyncio.run(main())
